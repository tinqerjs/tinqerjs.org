<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Tinqer - Type-safe LINQ-to-SQL query builder for TypeScript">
  <title>Guide - Tinqer Documentation</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Mobile Header -->
  <header class="mobile-header">
    <a href="index.html" class="mobile-logo">
      <img src="logo.svg" alt="Tinqer" class="logo-icon" />
      <span>Tinqer</span>
    </a>
    <button class="hamburger" id="hamburger" aria-label="Toggle menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </header>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="overlay"></div>

  <!-- Sidebar Navigation -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <a href="index.html" class="logo">
        <img src="logo.svg" alt="Tinqer" class="logo-icon" />
        <span>Tinqer</span>
      </a>
      <p class="tagline">Type-safe LINQ-to-SQL for TypeScript</p>
      <a href="https://github.com/tinqerjs/tinqer" class="github-link" target="_blank" rel="noopener noreferrer">
        <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
        </svg>
        <span>GitHub</span>
      </a>
    </div>
    <ul class="nav-list">
  <li><a href="index.html">Getting Started</a></li>
  <li class="active"><a href="guide.html">Guide</a></li>
  <li><a href="api-reference.html">API Reference</a></li>
  <li><a href="adapters.html">Adapters</a></li>
  <li><a href="development.html">Development</a></li>
  <li><a href="architecture.html">Architecture</a></li>
</ul>
  </nav>

  <!-- Main Content -->
  <main class="content">
    <div class="breadcrumb"><a href="index.html">Home</a> / <span>Guide</span></div>

    <div class="content-wrapper">
      <article class="markdown-body">
        <p><a href="../README.md">‚Üê Back to README</a></p>
<h1 id="tinqer-query-operations-guide" tabindex="-1"><a class="anchor" href="#tinqer-query-operations-guide" aria-hidden="true">#</a> Tinqer Query Operations Guide</h1>
<p>Complete reference for all query operations, parameters, and CRUD functionality in Tinqer.</p>
<h2 id="table-of-contents" tabindex="-1"><a class="anchor" href="#table-of-contents" aria-hidden="true">#</a> Table of Contents</h2>
<ul>
<li><a href="#1-filtering-operations">1. Filtering Operations</a>
<ul>
<li><a href="#11-basic-comparison">1.1 Basic Comparison</a></li>
<li><a href="#12-multiple-predicates">1.2 Multiple Predicates</a></li>
<li><a href="#13-logical-nesting-and-arithmetic">1.3 Logical Nesting and Arithmetic</a></li>
<li><a href="#14-null-checks-and-null-coalescing">1.4 Null Checks and Null Coalescing</a></li>
<li><a href="#15-string-operations">1.5 String Operations</a></li>
<li><a href="#16-case-insensitive-helpers">1.6 Case-Insensitive Helpers</a></li>
<li><a href="#17-array-membership-in">1.7 Array Membership (IN)</a></li>
<li><a href="#18-combined-filter-example">1.8 Combined Filter Example</a></li>
</ul>
</li>
<li><a href="#2-projections">2. Projections</a>
<ul>
<li><a href="#21-full-row-projection">2.1 Full Row Projection</a></li>
<li><a href="#22-object-projection">2.2 Object Projection</a></li>
<li><a href="#23-projection-with-null-coalescing-and-arithmetic">2.3 Projection with Null Coalescing and Arithmetic</a></li>
</ul>
</li>
<li><a href="#3-ordering">3. Ordering</a>
<ul>
<li><a href="#31-single-key-ascending">3.1 Single Key Ascending</a></li>
<li><a href="#32-mixed-ordering">3.2 Mixed Ordering</a></li>
<li><a href="#33-reverse">3.3 Reverse</a></li>
</ul>
</li>
<li><a href="#4-distinct-operations">4. Distinct Operations</a></li>
<li><a href="#5-pagination">5. Pagination</a>
<ul>
<li><a href="#51-offsetlimit-pattern">5.1 Offset/Limit Pattern</a></li>
<li><a href="#52-pagination-with-filtering">5.2 Pagination with Filtering</a></li>
</ul>
</li>
<li><a href="#6-joins">6. Joins</a>
<ul>
<li><a href="#61-simple-inner-join">6.1 Simple Inner Join</a></li>
<li><a href="#62-join-with-additional-filter">6.2 Join with Additional Filter</a></li>
<li><a href="#63-join-with-grouped-results">6.3 Join with Grouped Results</a></li>
<li><a href="#64-left-outer-join">6.4 Left Outer Join</a></li>
<li><a href="#65-cross-join">6.5 Cross Join</a></li>
</ul>
</li>
<li><a href="#7-grouping-and-aggregation">7. Grouping and Aggregation</a>
<ul>
<li><a href="#71-basic-grouping">7.1 Basic Grouping</a></li>
<li><a href="#72-group-with-multiple-aggregates">7.2 Group with Multiple Aggregates</a></li>
<li><a href="#73-group-with-post-filter">7.3 Group with Post-Filter</a></li>
</ul>
</li>
<li><a href="#8-window-functions">8. Window Functions</a>
<ul>
<li><a href="#81-row_number">8.1 ROW_NUMBER</a></li>
<li><a href="#82-rank">8.2 RANK</a></li>
<li><a href="#83-dense_rank">8.3 DENSE_RANK</a></li>
<li><a href="#84-multiple-window-functions">8.4 Multiple Window Functions</a></li>
<li><a href="#85-filtering-on-window-function-results">8.5 Filtering on Window Function Results</a></li>
</ul>
</li>
<li><a href="#9-scalar-aggregates-on-root-queries">9. Scalar Aggregates on Root Queries</a></li>
<li><a href="#10-quantifiers">10. Quantifiers</a>
<ul>
<li><a href="#101-any-operation">10.1 Any Operation</a></li>
<li><a href="#102-all-operation">10.2 All Operation</a></li>
<li><a href="#103-contains-operation">10.3 Contains Operation</a></li>
</ul>
</li>
<li><a href="#11-element-retrieval">11. Element Retrieval</a></li>
<li><a href="#12-materialisation">12. Materialisation</a></li>
<li><a href="#13-parameters-and-auto-parameterisation">13. Parameters and Auto-Parameterisation</a>
<ul>
<li><a href="#131-external-parameter-objects">13.1 External Parameter Objects</a></li>
<li><a href="#132-literal-auto-parameterisation">13.2 Literal Auto-Parameterisation</a></li>
<li><a href="#133-array-membership">13.3 Array Membership</a></li>
<li><a href="#134-case-insensitive-helper-functions">13.4 Case-Insensitive Helper Functions</a></li>
</ul>
</li>
<li><a href="#14-crud-operations">14. CRUD Operations</a>
<ul>
<li><a href="#141-insert-statements">14.1 INSERT Statements</a></li>
<li><a href="#142-update-statements">14.2 UPDATE Statements</a></li>
<li><a href="#143-delete-statements">14.3 DELETE Statements</a></li>
<li><a href="#144-safety-features">14.4 Safety Features</a></li>
<li><a href="#145-executing-crud-operations">14.5 Executing CRUD Operations</a></li>
</ul>
</li>
<li><a href="#15-query-composition-and-reusability">15. Query Composition and Reusability</a>
<ul>
<li><a href="#151-chaining-operations-on-plans">15.1 Chaining Operations on Plans</a></li>
<li><a href="#152-immutability-and-base-queries">15.2 Immutability and Base Queries</a></li>
<li><a href="#153-branching-from-base-queries">15.3 Branching from Base Queries</a></li>
<li><a href="#154-parameter-accumulation">15.4 Parameter Accumulation</a></li>
<li><a href="#155-composition-with-all-operations">15.5 Composition with All Operations</a></li>
<li><a href="#156-practical-patterns">15.6 Practical Patterns</a></li>
</ul>
</li>
<li><a href="#16-row-filters">16. Row Filters</a>
<ul>
<li><a href="#161-basic-usage">16.1 Basic Usage</a></li>
<li><a href="#162-per-operation-filters">16.2 Per-Operation Filters</a></li>
<li><a href="#163-behavior-notes">16.3 Behavior Notes</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="1-filtering-operations" tabindex="-1"><a class="anchor" href="#1-filtering-operations" aria-hidden="true">#</a> 1. Filtering Operations</h2>
<p>The <code>where</code> method applies predicates to filter query results. Multiple <code>where</code> calls are combined with AND logic.</p>
<h3 id="11-basic-comparison" tabindex="-1"><a class="anchor" href="#11-basic-comparison" aria-hidden="true">#</a> 1.1 Basic Comparison</h3>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema, defineSelect } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { toSql } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">active</span>: <span class="hljs-built_in">boolean</span> };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> adults = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>)),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;age&quot; <span class="hljs-operator">&gt;=</span> $(__p1)
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;age&quot; <span class="hljs-operator">&gt;=</span> @__p1
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">18</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="12-multiple-predicates" tabindex="-1"><a class="anchor" href="#12-multiple-predicates" aria-hidden="true">#</a> 1.2 Multiple Predicates</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> activeRange = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">21</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &lt;= <span class="hljs-number">60</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">active</span> === <span class="hljs-literal">true</span>),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot;
<span class="hljs-keyword">WHERE</span> &quot;age&quot; <span class="hljs-operator">&gt;=</span> $(__p1) <span class="hljs-keyword">AND</span> &quot;age&quot; <span class="hljs-operator">&lt;=</span> $(__p2) <span class="hljs-keyword">AND</span> &quot;active&quot; <span class="hljs-operator">=</span> $(__p3)
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot;
<span class="hljs-keyword">WHERE</span> &quot;age&quot; <span class="hljs-operator">&gt;=</span> @__p1 <span class="hljs-keyword">AND</span> &quot;age&quot; <span class="hljs-operator">&lt;=</span> @__p2 <span class="hljs-keyword">AND</span> &quot;active&quot; <span class="hljs-operator">=</span> @__p3
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">60</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p3&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="13-logical-nesting-and-arithmetic" tabindex="-1"><a class="anchor" href="#13-logical-nesting-and-arithmetic" aria-hidden="true">#</a> 1.3 Logical Nesting and Arithmetic</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> premium = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> (u.<span class="hljs-property">salary</span> * <span class="hljs-number">0.9</span> &gt; <span class="hljs-number">150_000</span> &amp;&amp; u.<span class="hljs-property">age</span> &lt; <span class="hljs-number">55</span>) || u.<span class="hljs-property">active</span> === <span class="hljs-literal">false</span>),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot;
<span class="hljs-keyword">WHERE</span> (((&quot;salary&quot; <span class="hljs-operator">*</span> $(__p1)) <span class="hljs-operator">&gt;</span> $(__p2) <span class="hljs-keyword">AND</span> &quot;age&quot; <span class="hljs-operator">&lt;</span> $(__p3)) <span class="hljs-keyword">OR</span> &quot;active&quot; <span class="hljs-operator">=</span> $(__p4))
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot;
<span class="hljs-keyword">WHERE</span> (((&quot;salary&quot; <span class="hljs-operator">*</span> @__p1) <span class="hljs-operator">&gt;</span> @__p2 <span class="hljs-keyword">AND</span> &quot;age&quot; <span class="hljs-operator">&lt;</span> @__p3) <span class="hljs-keyword">OR</span> &quot;active&quot; <span class="hljs-operator">=</span> @__p4)
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">150000</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p3&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p4&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="14-null-checks-and-null-coalescing" tabindex="-1"><a class="anchor" href="#14-null-checks-and-null-coalescing" aria-hidden="true">#</a> 1.4 Null Checks and Null Coalescing</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> preferredName = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> (u.<span class="hljs-property">nickname</span> ?? u.<span class="hljs-property">name</span>) === <span class="hljs-string">&quot;anonymous&quot;</span>)),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">COALESCE</span>(&quot;nickname&quot;, &quot;name&quot;) <span class="hljs-operator">=</span> $(__p1)
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">COALESCE</span>(&quot;nickname&quot;, &quot;name&quot;) <span class="hljs-operator">=</span> @__p1
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;anonymous&quot;</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="15-string-operations" tabindex="-1"><a class="anchor" href="#15-string-operations" aria-hidden="true">#</a> 1.5 String Operations</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> emailFilters = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">email</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;admin&quot;</span>))
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">email</span>.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&quot;@example.com&quot;</span>))
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">name</span>.<span class="hljs-title function_">toLowerCase</span>() === <span class="hljs-string">&quot;john&quot;</span>),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot;
<span class="hljs-keyword">WHERE</span> &quot;email&quot; <span class="hljs-keyword">LIKE</span> $(__p1) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;%&#x27;</span>
  <span class="hljs-keyword">AND</span> &quot;email&quot; <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-operator">||</span> $(__p2)
  <span class="hljs-keyword">AND</span> <span class="hljs-built_in">LOWER</span>(&quot;name&quot;) <span class="hljs-operator">=</span> $(__p3)
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot;
<span class="hljs-keyword">WHERE</span> &quot;email&quot; <span class="hljs-keyword">LIKE</span> @__p1 <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;%&#x27;</span>
  <span class="hljs-keyword">AND</span> &quot;email&quot; <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-operator">||</span> @__p2
  <span class="hljs-keyword">AND</span> <span class="hljs-built_in">LOWER</span>(&quot;name&quot;) <span class="hljs-operator">=</span> @__p3
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;@example.com&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p3&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;john&quot;</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="16-case-insensitive-helpers" tabindex="-1"><a class="anchor" href="#16-case-insensitive-helpers" aria-hidden="true">#</a> 1.6 Case-Insensitive Helpers</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> insensitive = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> helpers.<span class="hljs-property">functions</span>.<span class="hljs-title function_">iequals</span>(u.<span class="hljs-property">name</span>, <span class="hljs-string">&quot;ALICE&quot;</span>)),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">LOWER</span>(&quot;name&quot;) <span class="hljs-operator">=</span> <span class="hljs-built_in">LOWER</span>($(__p1))
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">LOWER</span>(&quot;name&quot;) <span class="hljs-operator">=</span> <span class="hljs-built_in">LOWER</span>(@__p1)
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ALICE&quot;</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="17-array-membership-(in)" tabindex="-1"><a class="anchor" href="#17-array-membership-(in)" aria-hidden="true">#</a> 1.7 Array Membership (IN)</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> allowed = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> [<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;support&quot;</span>, <span class="hljs-string">&quot;auditor&quot;</span>].<span class="hljs-title function_">includes</span>(u.<span class="hljs-property">role</span>)),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;role&quot; <span class="hljs-keyword">IN</span> ($(__p1), $(__p2), $(__p3))
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;role&quot; <span class="hljs-keyword">IN</span> (@__p1, @__p2, @__p3)
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;support&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p3&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;auditor&quot;</span> <span class="hljs-punctuation">}</span>
</code></pre>
<p>Negating the predicate (<code>!array.includes(...)</code>) yields <code>NOT IN</code>.</p>
<h3 id="18-combined-filter-example" tabindex="-1"><a class="anchor" href="#18-combined-filter-example" aria-hidden="true">#</a> 1.8 Combined Filter Example</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> advancedFilter = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { minAge: <span class="hljs-built_in">number</span>; categories: <span class="hljs-built_in">string</span>[] }, helpers</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt;= params.<span class="hljs-property">minAge</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> params.<span class="hljs-property">categories</span>.<span class="hljs-title function_">includes</span>(u.<span class="hljs-property">departmentId</span>.<span class="hljs-title function_">toString</span>()))
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> helpers.<span class="hljs-property">functions</span>.<span class="hljs-title function_">icontains</span>(u.<span class="hljs-property">email</span>, <span class="hljs-string">&quot;company&quot;</span>)),
  ),
  { <span class="hljs-attr">minAge</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">categories</span>: [<span class="hljs-string">&quot;10&quot;</span>, <span class="hljs-string">&quot;11&quot;</span>] },
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot;
<span class="hljs-keyword">WHERE</span> &quot;age&quot; <span class="hljs-operator">&gt;=</span> $(minAge)
  <span class="hljs-keyword">AND</span> &quot;departmentId&quot; <span class="hljs-keyword">IN</span> ($(categories_0), $(categories_1))
  <span class="hljs-keyword">AND</span> <span class="hljs-built_in">LOWER</span>(&quot;email&quot;) <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-operator">||</span> <span class="hljs-built_in">LOWER</span>($(__p1)) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;%&#x27;</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot;
<span class="hljs-keyword">WHERE</span> &quot;age&quot; <span class="hljs-operator">&gt;=</span> <span class="hljs-variable">@minAge</span>
  <span class="hljs-keyword">AND</span> &quot;departmentId&quot; <span class="hljs-keyword">IN</span> (<span class="hljs-variable">@categories_0</span>, <span class="hljs-variable">@categories_1</span>)
  <span class="hljs-keyword">AND</span> <span class="hljs-built_in">LOWER</span>(&quot;email&quot;) <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-operator">||</span> <span class="hljs-built_in">LOWER</span>(@__p1) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;%&#x27;</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;minAge&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">25</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;categories&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;10&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;11&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;categories_0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;categories_1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;11&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;company&quot;</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr>
<h2 id="2-projections" tabindex="-1"><a class="anchor" href="#2-projections" aria-hidden="true">#</a> 2. Projections</h2>
<p>The <code>select</code> method transforms query results by projecting columns or computed expressions.</p>
<h3 id="21-full-row-projection" tabindex="-1"><a class="anchor" href="#21-full-row-projection" aria-hidden="true">#</a> 2.1 Full Row Projection</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> fullRow = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot;
</code></pre>
<h3 id="22-object-projection" tabindex="-1"><a class="anchor" href="#22-object-projection" aria-hidden="true">#</a> 2.2 Object Projection</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> summary = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">active</span>)
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> ({
        <span class="hljs-attr">id</span>: u.<span class="hljs-property">id</span>,
        <span class="hljs-attr">name</span>: u.<span class="hljs-property">name</span>,
        <span class="hljs-attr">contact</span>: {
          <span class="hljs-attr">email</span>: u.<span class="hljs-property">email</span>,
        },
      })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;id&quot; <span class="hljs-keyword">AS</span> &quot;id&quot;, &quot;name&quot; <span class="hljs-keyword">AS</span> &quot;name&quot;, &quot;email&quot; <span class="hljs-keyword">AS</span> &quot;contact.email&quot; <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;active&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;id&quot; <span class="hljs-keyword">AS</span> &quot;id&quot;, &quot;name&quot; <span class="hljs-keyword">AS</span> &quot;name&quot;, &quot;email&quot; <span class="hljs-keyword">AS</span> &quot;contact.email&quot; <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;active&quot;
</code></pre>
<h3 id="23-projection-with-null-coalescing-and-arithmetic" tabindex="-1"><a class="anchor" href="#23-projection-with-null-coalescing-and-arithmetic" aria-hidden="true">#</a> 2.3 Projection with Null Coalescing and Arithmetic</h3>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductSchema</span> {
  <span class="hljs-attr">products</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">discount</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">ProductSchema</span>&gt;();

<span class="hljs-keyword">const</span> pricing = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;products&quot;</span>).<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> ({
      <span class="hljs-attr">id</span>: p.<span class="hljs-property">id</span>,
      <span class="hljs-attr">name</span>: p.<span class="hljs-property">name</span>,
      <span class="hljs-attr">effectivePrice</span>: p.<span class="hljs-property">price</span> - (p.<span class="hljs-property">discount</span> ?? <span class="hljs-number">0</span>),
    })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;id&quot; <span class="hljs-keyword">AS</span> &quot;id&quot;, &quot;name&quot; <span class="hljs-keyword">AS</span> &quot;name&quot;, (&quot;price&quot; <span class="hljs-operator">-</span> <span class="hljs-built_in">COALESCE</span>(&quot;discount&quot;, $(__p1))) <span class="hljs-keyword">AS</span> &quot;effectivePrice&quot; <span class="hljs-keyword">FROM</span> &quot;products&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;id&quot; <span class="hljs-keyword">AS</span> &quot;id&quot;, &quot;name&quot; <span class="hljs-keyword">AS</span> &quot;name&quot;, (&quot;price&quot; <span class="hljs-operator">-</span> <span class="hljs-built_in">COALESCE</span>(&quot;discount&quot;, @__p1)) <span class="hljs-keyword">AS</span> &quot;effectivePrice&quot; <span class="hljs-keyword">FROM</span> &quot;products&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span> <span class="hljs-punctuation">}</span>
</code></pre>
<hr>
<h2 id="3-ordering" tabindex="-1"><a class="anchor" href="#3-ordering" aria-hidden="true">#</a> 3. Ordering</h2>
<p>Methods <code>orderBy</code>, <code>orderByDescending</code>, <code>thenBy</code>, and <code>thenByDescending</code> control result ordering.</p>
<h3 id="31-single-key-ascending" tabindex="-1"><a class="anchor" href="#31-single-key-ascending" aria-hidden="true">#</a> 3.1 Single Key Ascending</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> alphabetical = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">name</span>)),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;name&quot; <span class="hljs-keyword">ASC</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;name&quot; <span class="hljs-keyword">ASC</span>
</code></pre>
<h3 id="32-mixed-ordering" tabindex="-1"><a class="anchor" href="#32-mixed-ordering" aria-hidden="true">#</a> 3.2 Mixed Ordering</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> ordered = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">departmentId</span>)
      .<span class="hljs-title function_">thenByDescending</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">salary</span>)
      .<span class="hljs-title function_">thenBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">name</span>),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;departmentId&quot; <span class="hljs-keyword">ASC</span>, &quot;salary&quot; <span class="hljs-keyword">DESC</span>, &quot;name&quot; <span class="hljs-keyword">ASC</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;departmentId&quot; <span class="hljs-keyword">ASC</span>, &quot;salary&quot; <span class="hljs-keyword">DESC</span>, &quot;name&quot; <span class="hljs-keyword">ASC</span>
</code></pre>
<h3 id="33-reverse" tabindex="-1"><a class="anchor" href="#33-reverse" aria-hidden="true">#</a> 3.3 Reverse</h3>
<p><code>reverse()</code> flips the effective ordering. If an explicit <code>orderBy</code>/<code>thenBy</code> chain exists, Tinqer inverts the direction of each ordering. If no <code>orderBy</code> exists, Tinqer emits <code>ORDER BY 1 DESC</code>.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> reversed = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">name</span>)
      .<span class="hljs-title function_">reverse</span>(),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;name&quot; <span class="hljs-keyword">DESC</span>

<span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;name&quot; <span class="hljs-keyword">DESC</span>
</code></pre>
<blockquote>
<p><strong>Note:</strong> <code>reverse()</code> after <code>take()</code>/<code>skip()</code> is not supported. Apply <code>reverse()</code> before pagination.</p>
</blockquote>
<hr>
<h2 id="4-distinct-operations" tabindex="-1"><a class="anchor" href="#4-distinct-operations" aria-hidden="true">#</a> 4. Distinct Operations</h2>
<pre class="hljs"><code><span class="hljs-keyword">const</span> departments = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">departmentId</span>)
      .<span class="hljs-title function_">distinct</span>(),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> &quot;departmentId&quot; <span class="hljs-keyword">AS</span> &quot;departmentId&quot; <span class="hljs-keyword">FROM</span> &quot;users&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> &quot;departmentId&quot; <span class="hljs-keyword">AS</span> &quot;departmentId&quot; <span class="hljs-keyword">FROM</span> &quot;users&quot;
</code></pre>
<hr>
<h2 id="5-pagination" tabindex="-1"><a class="anchor" href="#5-pagination" aria-hidden="true">#</a> 5. Pagination</h2>
<p>Methods <code>skip</code> and <code>take</code> implement OFFSET and LIMIT clauses.</p>
<h3 id="51-offset%2Flimit-pattern" tabindex="-1"><a class="anchor" href="#51-offset%2Flimit-pattern" aria-hidden="true">#</a> 5.1 Offset/Limit Pattern</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> page = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">id</span>)
      .<span class="hljs-title function_">skip</span>(<span class="hljs-number">30</span>)
      .<span class="hljs-title function_">take</span>(<span class="hljs-number">15</span>),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;id&quot; <span class="hljs-keyword">ASC</span> LIMIT $(__p2) <span class="hljs-keyword">OFFSET</span> $(__p1)
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;id&quot; <span class="hljs-keyword">ASC</span> LIMIT @__p2 <span class="hljs-keyword">OFFSET</span> @__p1
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="52-pagination-with-filtering" tabindex="-1"><a class="anchor" href="#52-pagination-with-filtering" aria-hidden="true">#</a> 5.2 Pagination with Filtering</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> filteredPage = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">active</span>)
      .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">name</span>)
      .<span class="hljs-title function_">skip</span>(<span class="hljs-number">50</span>)
      .<span class="hljs-title function_">take</span>(<span class="hljs-number">25</span>),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;active&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;name&quot; <span class="hljs-keyword">ASC</span> LIMIT $(__p3) <span class="hljs-keyword">OFFSET</span> $(__p2)
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;active&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;name&quot; <span class="hljs-keyword">ASC</span> LIMIT @__p3 <span class="hljs-keyword">OFFSET</span> @__p2
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p3&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">25</span> <span class="hljs-punctuation">}</span>
</code></pre>
<hr>
<h2 id="6-joins" tabindex="-1"><a class="anchor" href="#6-joins" aria-hidden="true">#</a> 6. Joins</h2>
<p>The <code>join</code> method creates INNER JOIN operations. Left outer joins and cross joins follow the same LINQ patterns used in .NET: <code>groupJoin</code> + <code>selectMany(...defaultIfEmpty())</code> for left joins, and <code>selectMany</code> with a query-returning collection selector for cross joins.</p>
<h3 id="61-simple-inner-join" tabindex="-1"><a class="anchor" href="#61-simple-inner-join" aria-hidden="true">#</a> 6.1 Simple Inner Join</h3>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">JoinSchema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">departmentId</span>: <span class="hljs-built_in">number</span> };
  <span class="hljs-attr">departments</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">JoinSchema</span>&gt;();

<span class="hljs-keyword">const</span> userDepartments = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">join</span>(
      q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;departments&quot;</span>),
      <span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">departmentId</span>,
      <span class="hljs-function">(<span class="hljs-params">d</span>) =&gt;</span> d.<span class="hljs-property">id</span>,
      <span class="hljs-function">(<span class="hljs-params">u, d</span>) =&gt;</span> ({ <span class="hljs-attr">userName</span>: u.<span class="hljs-property">name</span>, <span class="hljs-attr">departmentName</span>: d.<span class="hljs-property">name</span> }),
    ),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;t0&quot;.&quot;name&quot; <span class="hljs-keyword">AS</span> &quot;userName&quot;, &quot;t1&quot;.&quot;name&quot; <span class="hljs-keyword">AS</span> &quot;departmentName&quot;
<span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">AS</span> &quot;t0&quot;
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> &quot;departments&quot; <span class="hljs-keyword">AS</span> &quot;t1&quot; <span class="hljs-keyword">ON</span> &quot;t0&quot;.&quot;departmentId&quot; <span class="hljs-operator">=</span> &quot;t1&quot;.&quot;id&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;t0&quot;.&quot;name&quot; <span class="hljs-keyword">AS</span> &quot;userName&quot;, &quot;t1&quot;.&quot;name&quot; <span class="hljs-keyword">AS</span> &quot;departmentName&quot;
<span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">AS</span> &quot;t0&quot;
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> &quot;departments&quot; <span class="hljs-keyword">AS</span> &quot;t1&quot; <span class="hljs-keyword">ON</span> &quot;t0&quot;.&quot;departmentId&quot; <span class="hljs-operator">=</span> &quot;t1&quot;.&quot;id&quot;
</code></pre>
<h3 id="62-join-with-additional-filter" tabindex="-1"><a class="anchor" href="#62-join-with-additional-filter" aria-hidden="true">#</a> 6.2 Join with Additional Filter</h3>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderSchema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> };
  <span class="hljs-attr">orders</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">userId</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">total</span>: <span class="hljs-built_in">number</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">OrderSchema</span>&gt;();

<span class="hljs-keyword">const</span> regionOrders = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">id</span> &gt; <span class="hljs-number">100</span>)
      .<span class="hljs-title function_">join</span>(
        q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;orders&quot;</span>),
        <span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">id</span>,
        <span class="hljs-function">(<span class="hljs-params">o</span>) =&gt;</span> o.<span class="hljs-property">userId</span>,
        <span class="hljs-function">(<span class="hljs-params">u, o</span>) =&gt;</span> ({ <span class="hljs-attr">userName</span>: u.<span class="hljs-property">name</span>, <span class="hljs-attr">total</span>: o.<span class="hljs-property">total</span> }),
      )
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">row</span>) =&gt;</span> row.<span class="hljs-property">total</span> &gt; <span class="hljs-number">500</span>),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;t0&quot;.&quot;name&quot; <span class="hljs-keyword">AS</span> &quot;userName&quot;, &quot;t1&quot;.&quot;total&quot; <span class="hljs-keyword">AS</span> &quot;total&quot;
<span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">AS</span> &quot;t0&quot;
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> &quot;orders&quot; <span class="hljs-keyword">AS</span> &quot;t1&quot; <span class="hljs-keyword">ON</span> &quot;t0&quot;.&quot;id&quot; <span class="hljs-operator">=</span> &quot;t1&quot;.&quot;userId&quot;
<span class="hljs-keyword">WHERE</span> &quot;t0&quot;.&quot;id&quot; <span class="hljs-operator">&gt;</span> $(__p1) <span class="hljs-keyword">AND</span> &quot;t1&quot;.&quot;total&quot; <span class="hljs-operator">&gt;</span> $(__p2)
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;t0&quot;.&quot;name&quot; <span class="hljs-keyword">AS</span> &quot;userName&quot;, &quot;t1&quot;.&quot;total&quot; <span class="hljs-keyword">AS</span> &quot;total&quot;
<span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">AS</span> &quot;t0&quot;
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> &quot;orders&quot; <span class="hljs-keyword">AS</span> &quot;t1&quot; <span class="hljs-keyword">ON</span> &quot;t0&quot;.&quot;id&quot; <span class="hljs-operator">=</span> &quot;t1&quot;.&quot;userId&quot;
<span class="hljs-keyword">WHERE</span> &quot;t0&quot;.&quot;id&quot; <span class="hljs-operator">&gt;</span> @__p1 <span class="hljs-keyword">AND</span> &quot;t1&quot;.&quot;total&quot; <span class="hljs-operator">&gt;</span> @__p2
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">500</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="63-join-with-grouped-results" tabindex="-1"><a class="anchor" href="#63-join-with-grouped-results" aria-hidden="true">#</a> 6.3 Join with Grouped Results</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> totalsByDepartment = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">join</span>(
        q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;orders&quot;</span>),
        <span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">id</span>,
        <span class="hljs-function">(<span class="hljs-params">o</span>) =&gt;</span> o.<span class="hljs-property">userId</span>,
        <span class="hljs-function">(<span class="hljs-params">u, o</span>) =&gt;</span> ({ u, o }),
      )
      .<span class="hljs-title function_">groupBy</span>(<span class="hljs-function">(<span class="hljs-params">joined</span>) =&gt;</span> joined.<span class="hljs-property">u</span>.<span class="hljs-property">departmentId</span>)
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">g</span>) =&gt;</span> ({
        <span class="hljs-attr">departmentId</span>: g.<span class="hljs-property">key</span>,
        <span class="hljs-attr">totalOrders</span>: g.<span class="hljs-title function_">count</span>(),
        <span class="hljs-attr">revenue</span>: g.<span class="hljs-title function_">sum</span>(<span class="hljs-function">(<span class="hljs-params">row</span>) =&gt;</span> row.<span class="hljs-property">o</span>.<span class="hljs-property">total</span>),
      })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;t0&quot;.&quot;departmentId&quot; <span class="hljs-keyword">AS</span> &quot;departmentId&quot;, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> &quot;totalOrders&quot;, <span class="hljs-built_in">SUM</span>(&quot;t1&quot;.&quot;total&quot;) <span class="hljs-keyword">AS</span> &quot;revenue&quot;
<span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">AS</span> &quot;t0&quot;
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> &quot;orders&quot; <span class="hljs-keyword">AS</span> &quot;t1&quot; <span class="hljs-keyword">ON</span> &quot;t0&quot;.&quot;id&quot; <span class="hljs-operator">=</span> &quot;t1&quot;.&quot;userId&quot;
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> &quot;t0&quot;.&quot;departmentId&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;t0&quot;.&quot;departmentId&quot; <span class="hljs-keyword">AS</span> &quot;departmentId&quot;, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> &quot;totalOrders&quot;, <span class="hljs-built_in">SUM</span>(&quot;t1&quot;.&quot;total&quot;) <span class="hljs-keyword">AS</span> &quot;revenue&quot;
<span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">AS</span> &quot;t0&quot;
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> &quot;orders&quot; <span class="hljs-keyword">AS</span> &quot;t1&quot; <span class="hljs-keyword">ON</span> &quot;t0&quot;.&quot;id&quot; <span class="hljs-operator">=</span> &quot;t1&quot;.&quot;userId&quot;
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> &quot;t0&quot;.&quot;departmentId&quot;
</code></pre>
<h3 id="64-left-outer-join" tabindex="-1"><a class="anchor" href="#64-left-outer-join" aria-hidden="true">#</a> 6.4 Left Outer Join</h3>
<p>Model the classic LINQ pattern: start with <code>groupJoin</code>, then expand the grouped results with <code>selectMany(...defaultIfEmpty())</code>. Any missing matches appear as <code>null</code> in the projection.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> usersWithDepartments = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">groupJoin</span>(
        q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;departments&quot;</span>),
        <span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> user.<span class="hljs-property">departmentId</span>,
        <span class="hljs-function">(<span class="hljs-params">department</span>) =&gt;</span> department.<span class="hljs-property">id</span>,
        <span class="hljs-function">(<span class="hljs-params">user, deptGroup</span>) =&gt;</span> ({ user, deptGroup }),
      )
      .<span class="hljs-title function_">selectMany</span>(
        <span class="hljs-function">(<span class="hljs-params">g</span>) =&gt;</span> g.<span class="hljs-property">deptGroup</span>.<span class="hljs-title function_">defaultIfEmpty</span>(),
        <span class="hljs-function">(<span class="hljs-params">g, department</span>) =&gt;</span> ({ <span class="hljs-attr">user</span>: g.<span class="hljs-property">user</span>, department }),
      )
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">row</span>) =&gt;</span> ({
        <span class="hljs-attr">userId</span>: row.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>,
        <span class="hljs-attr">departmentName</span>: row.<span class="hljs-property">department</span> ? row.<span class="hljs-property">department</span>.<span class="hljs-property">name</span> : <span class="hljs-literal">null</span>,
      })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;t0&quot;.&quot;id&quot; <span class="hljs-keyword">AS</span> &quot;userId&quot;, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> &quot;t1&quot;.&quot;id&quot; <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">THEN</span> &quot;t1&quot;.&quot;name&quot; <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> &quot;departmentName&quot;
<span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">AS</span> &quot;t0&quot;
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> &quot;departments&quot; <span class="hljs-keyword">AS</span> &quot;t1&quot; <span class="hljs-keyword">ON</span> &quot;t0&quot;.&quot;departmentId&quot; <span class="hljs-operator">=</span> &quot;t1&quot;.&quot;id&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;t0&quot;.&quot;id&quot; <span class="hljs-keyword">AS</span> &quot;userId&quot;, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> &quot;t1&quot;.&quot;id&quot; <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">THEN</span> &quot;t1&quot;.&quot;name&quot; <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> &quot;departmentName&quot;
<span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">AS</span> &quot;t0&quot;
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> &quot;departments&quot; <span class="hljs-keyword">AS</span> &quot;t1&quot; <span class="hljs-keyword">ON</span> &quot;t0&quot;.&quot;departmentId&quot; <span class="hljs-operator">=</span> &quot;t1&quot;.&quot;id&quot;
</code></pre>
<h3 id="65-cross-join" tabindex="-1"><a class="anchor" href="#65-cross-join" aria-hidden="true">#</a> 6.5 Cross Join</h3>
<p>Return a <code>Queryable</code> from the collection selector passed to <code>selectMany</code>. Because we skip <code>defaultIfEmpty</code>, the parser normalizes the operation into a <code>CROSS JOIN</code>.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> departmentUsers = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;departments&quot;</span>)
      .<span class="hljs-title function_">selectMany</span>(
        <span class="hljs-function">() =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>),
        <span class="hljs-function">(<span class="hljs-params">department, user</span>) =&gt;</span> ({ department, user }),
      )
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">row</span>) =&gt;</span> ({
        <span class="hljs-attr">departmentId</span>: row.<span class="hljs-property">department</span>.<span class="hljs-property">id</span>,
        <span class="hljs-attr">userId</span>: row.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>,
      })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;t0&quot;.&quot;id&quot; <span class="hljs-keyword">AS</span> &quot;departmentId&quot;, &quot;t1&quot;.&quot;id&quot; <span class="hljs-keyword">AS</span> &quot;userId&quot;
<span class="hljs-keyword">FROM</span> &quot;departments&quot; <span class="hljs-keyword">AS</span> &quot;t0&quot;
<span class="hljs-keyword">CROSS</span> <span class="hljs-keyword">JOIN</span> &quot;users&quot; <span class="hljs-keyword">AS</span> &quot;t1&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;t0&quot;.&quot;id&quot; <span class="hljs-keyword">AS</span> &quot;departmentId&quot;, &quot;t1&quot;.&quot;id&quot; <span class="hljs-keyword">AS</span> &quot;userId&quot;
<span class="hljs-keyword">FROM</span> &quot;departments&quot; <span class="hljs-keyword">AS</span> &quot;t0&quot;
<span class="hljs-keyword">CROSS</span> <span class="hljs-keyword">JOIN</span> &quot;users&quot; <span class="hljs-keyword">AS</span> &quot;t1&quot;
</code></pre>
<p>Right and full outer joins still require manual SQL, mirroring the .NET APIs.</p>
<hr>
<h2 id="7-grouping-and-aggregation" tabindex="-1"><a class="anchor" href="#7-grouping-and-aggregation" aria-hidden="true">#</a> 7. Grouping and Aggregation</h2>
<p>The <code>groupBy</code> method groups results and enables aggregate functions: <code>count</code>, <code>sum</code>, <code>avg</code>, <code>min</code>, <code>max</code>.</p>
<h3 id="71-basic-grouping" tabindex="-1"><a class="anchor" href="#71-basic-grouping" aria-hidden="true">#</a> 7.1 Basic Grouping</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> byDepartment = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">groupBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">departmentId</span>)),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;departmentId&quot; <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> &quot;departmentId&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;departmentId&quot; <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> &quot;departmentId&quot;
</code></pre>
<h3 id="72-group-with-multiple-aggregates" tabindex="-1"><a class="anchor" href="#72-group-with-multiple-aggregates" aria-hidden="true">#</a> 7.2 Group with Multiple Aggregates</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> departmentStats = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">groupBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">departmentId</span>)
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">g</span>) =&gt;</span> ({
        <span class="hljs-attr">departmentId</span>: g.<span class="hljs-property">key</span>,
        <span class="hljs-attr">headcount</span>: g.<span class="hljs-title function_">count</span>(),
        <span class="hljs-attr">totalSalary</span>: g.<span class="hljs-title function_">sum</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">salary</span>),
        <span class="hljs-attr">averageSalary</span>: g.<span class="hljs-title function_">avg</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">salary</span>),
        <span class="hljs-attr">maxSalary</span>: g.<span class="hljs-title function_">max</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">salary</span>),
      }))
      .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">row</span>) =&gt;</span> row.<span class="hljs-property">totalSalary</span>),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;departmentId&quot; <span class="hljs-keyword">AS</span> &quot;departmentId&quot;, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> &quot;headcount&quot;, <span class="hljs-built_in">SUM</span>(&quot;salary&quot;) <span class="hljs-keyword">AS</span> &quot;totalSalary&quot;, <span class="hljs-built_in">AVG</span>(&quot;salary&quot;) <span class="hljs-keyword">AS</span> &quot;averageSalary&quot;, <span class="hljs-built_in">MAX</span>(&quot;salary&quot;) <span class="hljs-keyword">AS</span> &quot;maxSalary&quot;
<span class="hljs-keyword">FROM</span> &quot;users&quot;
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> &quot;departmentId&quot;
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;totalSalary&quot; <span class="hljs-keyword">DESC</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;departmentId&quot; <span class="hljs-keyword">AS</span> &quot;departmentId&quot;, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> &quot;headcount&quot;, <span class="hljs-built_in">SUM</span>(&quot;salary&quot;) <span class="hljs-keyword">AS</span> &quot;totalSalary&quot;, <span class="hljs-built_in">AVG</span>(&quot;salary&quot;) <span class="hljs-keyword">AS</span> &quot;averageSalary&quot;, <span class="hljs-built_in">MAX</span>(&quot;salary&quot;) <span class="hljs-keyword">AS</span> &quot;maxSalary&quot;
<span class="hljs-keyword">FROM</span> &quot;users&quot;
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> &quot;departmentId&quot;
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;totalSalary&quot; <span class="hljs-keyword">DESC</span>
</code></pre>
<h3 id="73-group-with-post-filter" tabindex="-1"><a class="anchor" href="#73-group-with-post-filter" aria-hidden="true">#</a> 7.3 Group with Post-Filter</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> largeDepartments = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeSelect</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">groupBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">departmentId</span>)
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">g</span>) =&gt;</span> ({ <span class="hljs-attr">departmentId</span>: g.<span class="hljs-property">key</span>, <span class="hljs-attr">headcount</span>: g.<span class="hljs-title function_">count</span>() }))
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">row</span>) =&gt;</span> row.<span class="hljs-property">headcount</span> &gt; <span class="hljs-number">5</span>),
  {},
);
</code></pre>
<p>The adapter emits the <code>WHERE</code> on the grouped projection; explicit HAVING clauses are not generated.</p>
<hr>
<h2 id="8-window-functions" tabindex="-1"><a class="anchor" href="#8-window-functions" aria-hidden="true">#</a> 8. Window Functions</h2>
<p>Window functions perform calculations across rows related to the current row without collapsing the result set. Tinqer supports <code>ROW_NUMBER()</code>, <code>RANK()</code>, and <code>DENSE_RANK()</code> for ranking operations with optional partitioning and required ordering.</p>
<p>All window functions are accessed via the helpers parameter (second parameter in query builders) and support:</p>
<ul>
<li><strong><code>partitionBy(...selectors)</code></strong>: Optional partitioning (0 or more selectors)</li>
<li><strong><code>orderBy(selector)</code></strong> / <strong><code>orderByDescending(selector)</code></strong>: Required ordering (at least one)</li>
<li><strong><code>thenBy(selector)</code></strong> / <strong><code>thenByDescending(selector)</code></strong>: Additional ordering</li>
</ul>
<h3 id="81-row_number" tabindex="-1"><a class="anchor" href="#81-row_number" aria-hidden="true">#</a> 8.1 ROW_NUMBER</h3>
<p><code>ROW_NUMBER()</code> assigns sequential numbers to rows within a partition, starting from 1. The numbering resets for each partition.</p>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">EmployeeSchema</span> {
  <span class="hljs-attr">employees</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">department</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">salary</span>: <span class="hljs-built_in">number</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">EmployeeSchema</span>&gt;();

<span class="hljs-keyword">const</span> rankedEmployees = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;employees&quot;</span>).<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> ({
      <span class="hljs-attr">name</span>: e.<span class="hljs-property">name</span>,
      <span class="hljs-attr">department</span>: e.<span class="hljs-property">department</span>,
      <span class="hljs-attr">salary</span>: e.<span class="hljs-property">salary</span>,
      <span class="hljs-attr">rank</span>: helpers
        .<span class="hljs-title function_">window</span>(e)
        .<span class="hljs-title function_">partitionBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>)
        .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">salary</span>)
        .<span class="hljs-title function_">rowNumber</span>(),
    })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;name&quot;, &quot;department&quot;, &quot;salary&quot;,
  <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;
<span class="hljs-keyword">FROM</span> &quot;employees&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;name&quot;, &quot;department&quot;, &quot;salary&quot;,
  <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;
<span class="hljs-keyword">FROM</span> &quot;employees&quot;
</code></pre>
<h4 id="without-partition" tabindex="-1"><a class="anchor" href="#without-partition" aria-hidden="true">#</a> Without Partition</h4>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderTimeSchema</span> {
  <span class="hljs-attr">orders</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">OrderTimeSchema</span>&gt;();

<span class="hljs-keyword">const</span> chronological = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;orders&quot;</span>).<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">o</span>) =&gt;</span> ({
      <span class="hljs-attr">orderId</span>: o.<span class="hljs-property">id</span>,
      <span class="hljs-attr">rowNum</span>: helpers
        .<span class="hljs-title function_">window</span>(o)
        .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">createdAt</span>)
        .<span class="hljs-title function_">rowNumber</span>(),
    })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL and SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;id&quot; <span class="hljs-keyword">AS</span> &quot;orderId&quot;, <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;createdAt&quot; <span class="hljs-keyword">ASC</span>) <span class="hljs-keyword">AS</span> &quot;rowNum&quot;
<span class="hljs-keyword">FROM</span> &quot;orders&quot;
</code></pre>
<h4 id="multiple-partitions" tabindex="-1"><a class="anchor" href="#multiple-partitions" aria-hidden="true">#</a> Multiple Partitions</h4>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RegionEmployeeSchema</span> {
  <span class="hljs-attr">employees</span>: { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">region</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">department</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">salary</span>: <span class="hljs-built_in">number</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">RegionEmployeeSchema</span>&gt;();

<span class="hljs-keyword">const</span> multiPartition = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;employees&quot;</span>).<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> ({
      <span class="hljs-attr">name</span>: e.<span class="hljs-property">name</span>,
      <span class="hljs-attr">rank</span>: helpers
        .<span class="hljs-title function_">window</span>(e)
        .<span class="hljs-title function_">partitionBy</span>(
          <span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">region</span>,
          <span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>,
        )
        .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">salary</span>)
        .<span class="hljs-title function_">rowNumber</span>(),
    })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL and SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;name&quot;,
  <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;region&quot;, &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;
<span class="hljs-keyword">FROM</span> &quot;employees&quot;
</code></pre>
<h4 id="secondary-ordering-with-thenby" tabindex="-1"><a class="anchor" href="#secondary-ordering-with-thenby" aria-hidden="true">#</a> Secondary Ordering with thenBy</h4>
<pre class="hljs"><code><span class="hljs-keyword">const</span> ranked = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;employees&quot;</span>).<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> ({
      <span class="hljs-attr">name</span>: e.<span class="hljs-property">name</span>,
      <span class="hljs-attr">rank</span>: helpers
        .<span class="hljs-title function_">window</span>(e)
        .<span class="hljs-title function_">partitionBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>)
        .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">salary</span>)
        .<span class="hljs-title function_">thenBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">name</span>)
        .<span class="hljs-title function_">rowNumber</span>(),
    })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL and SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;name&quot;,
  <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>, &quot;name&quot; <span class="hljs-keyword">ASC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;
<span class="hljs-keyword">FROM</span> &quot;employees&quot;
</code></pre>
<h3 id="82-rank" tabindex="-1"><a class="anchor" href="#82-rank" aria-hidden="true">#</a> 8.2 RANK</h3>
<p><code>RANK()</code> assigns ranks with gaps for tied values. If two rows have the same rank, the next rank skips numbers.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> rankedSalaries = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;employees&quot;</span>).<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> ({
      <span class="hljs-attr">name</span>: e.<span class="hljs-property">name</span>,
      <span class="hljs-attr">salary</span>: e.<span class="hljs-property">salary</span>,
      <span class="hljs-attr">rank</span>: helpers
        .<span class="hljs-title function_">window</span>(e)
        .<span class="hljs-title function_">partitionBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>)
        .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">salary</span>)
        .<span class="hljs-title function_">rank</span>(),
    })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;name&quot;, &quot;salary&quot;,
  <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;
<span class="hljs-keyword">FROM</span> &quot;employees&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;name&quot;, &quot;salary&quot;,
  <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;
<span class="hljs-keyword">FROM</span> &quot;employees&quot;
</code></pre>
<p>Example result with gaps:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>salary</th>
<th>rank</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alice</td>
<td>90000</td>
<td>1</td>
</tr>
<tr>
<td>Bob</td>
<td>90000</td>
<td>1</td>
</tr>
<tr>
<td>Carol</td>
<td>85000</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>Notice rank 2 is skipped because two employees share rank 1.</p>
<h4 id="rank-without-partition" tabindex="-1"><a class="anchor" href="#rank-without-partition" aria-hidden="true">#</a> RANK Without Partition</h4>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PlayerSchema</span> {
  <span class="hljs-attr">players</span>: { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">score</span>: <span class="hljs-built_in">number</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">PlayerSchema</span>&gt;();

<span class="hljs-keyword">const</span> globalRank = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;players&quot;</span>).<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> ({
      <span class="hljs-attr">player</span>: p.<span class="hljs-property">name</span>,
      <span class="hljs-attr">score</span>: p.<span class="hljs-property">score</span>,
      <span class="hljs-attr">rank</span>: helpers
        .<span class="hljs-title function_">window</span>(p)
        .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">score</span>)
        .<span class="hljs-title function_">rank</span>(),
    })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL and SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;name&quot; <span class="hljs-keyword">AS</span> &quot;player&quot;, &quot;score&quot;, <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;score&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;
<span class="hljs-keyword">FROM</span> &quot;players&quot;
</code></pre>
<h3 id="83-dense_rank" tabindex="-1"><a class="anchor" href="#83-dense_rank" aria-hidden="true">#</a> 8.3 DENSE_RANK</h3>
<p><code>DENSE_RANK()</code> assigns ranks without gaps. Tied values receive the same rank, and the next rank is consecutive.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> denseRanked = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;employees&quot;</span>).<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> ({
      <span class="hljs-attr">name</span>: e.<span class="hljs-property">name</span>,
      <span class="hljs-attr">salary</span>: e.<span class="hljs-property">salary</span>,
      <span class="hljs-attr">rank</span>: helpers
        .<span class="hljs-title function_">window</span>(e)
        .<span class="hljs-title function_">partitionBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>)
        .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">salary</span>)
        .<span class="hljs-title function_">denseRank</span>(),
    })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;name&quot;, &quot;salary&quot;,
  <span class="hljs-built_in">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;
<span class="hljs-keyword">FROM</span> &quot;employees&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;name&quot;, &quot;salary&quot;,
  <span class="hljs-built_in">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;
<span class="hljs-keyword">FROM</span> &quot;employees&quot;
</code></pre>
<p>Example result without gaps:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>salary</th>
<th>rank</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alice</td>
<td>90000</td>
<td>1</td>
</tr>
<tr>
<td>Bob</td>
<td>90000</td>
<td>1</td>
</tr>
<tr>
<td>Carol</td>
<td>85000</td>
<td>2</td>
</tr>
</tbody>
</table>
<h4 id="complex-thenby-chain" tabindex="-1"><a class="anchor" href="#complex-thenby-chain" aria-hidden="true">#</a> Complex thenBy Chain</h4>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">EmployeeAgeSchema</span> {
  <span class="hljs-attr">employees</span>: { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">department</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">salary</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">EmployeeAgeSchema</span>&gt;();

<span class="hljs-keyword">const</span> complexRanking = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;employees&quot;</span>).<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> ({
      <span class="hljs-attr">name</span>: e.<span class="hljs-property">name</span>,
      <span class="hljs-attr">rank</span>: helpers
        .<span class="hljs-title function_">window</span>(e)
        .<span class="hljs-title function_">partitionBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>)
        .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">salary</span>)
        .<span class="hljs-title function_">thenByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">age</span>)
        .<span class="hljs-title function_">thenBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">name</span>)
        .<span class="hljs-title function_">denseRank</span>(),
    })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL and SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;name&quot;,
  <span class="hljs-built_in">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span> (
    <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot;
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>, &quot;age&quot; <span class="hljs-keyword">DESC</span>, &quot;name&quot; <span class="hljs-keyword">ASC</span>
  ) <span class="hljs-keyword">AS</span> &quot;rank&quot;
<span class="hljs-keyword">FROM</span> &quot;employees&quot;
</code></pre>
<h3 id="84-multiple-window-functions" tabindex="-1"><a class="anchor" href="#84-multiple-window-functions" aria-hidden="true">#</a> 8.4 Multiple Window Functions</h3>
<p>Combine multiple window functions in a single SELECT:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> allRankings = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;employees&quot;</span>).<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> ({
      <span class="hljs-attr">name</span>: e.<span class="hljs-property">name</span>,
      <span class="hljs-attr">department</span>: e.<span class="hljs-property">department</span>,
      <span class="hljs-attr">salary</span>: e.<span class="hljs-property">salary</span>,
      <span class="hljs-attr">rowNum</span>: helpers
        .<span class="hljs-title function_">window</span>(e)
        .<span class="hljs-title function_">partitionBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>)
        .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">salary</span>)
        .<span class="hljs-title function_">rowNumber</span>(),
      <span class="hljs-attr">rank</span>: helpers
        .<span class="hljs-title function_">window</span>(e)
        .<span class="hljs-title function_">partitionBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>)
        .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">salary</span>)
        .<span class="hljs-title function_">rank</span>(),
      <span class="hljs-attr">denseRank</span>: helpers
        .<span class="hljs-title function_">window</span>(e)
        .<span class="hljs-title function_">partitionBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>)
        .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">salary</span>)
        .<span class="hljs-title function_">denseRank</span>(),
    })),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> &quot;name&quot;, &quot;department&quot;, &quot;salary&quot;,
  <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rowNum&quot;,
  <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;,
  <span class="hljs-built_in">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;denseRank&quot;
<span class="hljs-keyword">FROM</span> &quot;employees&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> &quot;name&quot;, &quot;department&quot;, &quot;salary&quot;,
  <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rowNum&quot;,
  <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;,
  <span class="hljs-built_in">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;denseRank&quot;
<span class="hljs-keyword">FROM</span> &quot;employees&quot;
</code></pre>
<h3 id="85-filtering-on-window-function-results" tabindex="-1"><a class="anchor" href="#85-filtering-on-window-function-results" aria-hidden="true">#</a> 8.5 Filtering on Window Function Results</h3>
<p>Window function results can be filtered using <code>where()</code> clauses. Tinqer automatically wraps queries in subqueries when window function columns are referenced in WHERE conditions, since SQL does not allow filtering on window functions in the same query level where they‚Äôre defined.</p>
<h4 id="top-n-per-group" tabindex="-1"><a class="anchor" href="#top-n-per-group" aria-hidden="true">#</a> Top-N Per Group</h4>
<p>Get the top earner from each department:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> topEarners = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeSelect</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;employees&quot;</span>)
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> ({
        ...e,
        <span class="hljs-attr">rank</span>: helpers
          .<span class="hljs-title function_">window</span>(e)
          .<span class="hljs-title function_">partitionBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>)
          .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">salary</span>)
          .<span class="hljs-title function_">rowNumber</span>(),
      }))
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">rank</span> === <span class="hljs-number">1</span>)
      .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL (automatically wrapped in subquery)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> (
  <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>, <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;
  <span class="hljs-keyword">FROM</span> &quot;employees&quot;
) <span class="hljs-keyword">AS</span> &quot;employees&quot;
<span class="hljs-keyword">WHERE</span> &quot;rank&quot; <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ASC</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite (automatically wrapped in subquery)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> (
  <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>, <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;
  <span class="hljs-keyword">FROM</span> &quot;employees&quot;
) <span class="hljs-keyword">AS</span> &quot;employees&quot;
<span class="hljs-keyword">WHERE</span> &quot;rank&quot; <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ASC</span>
</code></pre>
<h4 id="top-3-per-group" tabindex="-1"><a class="anchor" href="#top-3-per-group" aria-hidden="true">#</a> Top-3 Per Group</h4>
<p>Get the top 3 highest-paid employees from a specific department:</p>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">EmployeeDeptSchema</span> {
  <span class="hljs-attr">employees</span>: { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">salary</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">department_id</span>: <span class="hljs-built_in">number</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">EmployeeDeptSchema</span>&gt;();

<span class="hljs-keyword">const</span> top3Engineering = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeSelect</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { deptId: <span class="hljs-built_in">number</span> }, helpers</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;employees&quot;</span>)
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> ({
        <span class="hljs-attr">name</span>: e.<span class="hljs-property">name</span>,
        <span class="hljs-attr">salary</span>: e.<span class="hljs-property">salary</span>,
        <span class="hljs-attr">rank</span>: helpers
          .<span class="hljs-title function_">window</span>(e)
          .<span class="hljs-title function_">partitionBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department_id</span>)
          .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">salary</span>)
          .<span class="hljs-title function_">rowNumber</span>(),
      }))
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">rank</span> &lt;= <span class="hljs-number">3</span> &amp;&amp; r.<span class="hljs-property">department_id</span> === params.<span class="hljs-property">deptId</span>)
      .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">rank</span>),
  { <span class="hljs-attr">deptId</span>: <span class="hljs-number">1</span> },
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL and SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> (
  <span class="hljs-keyword">SELECT</span> &quot;name&quot;, &quot;salary&quot;, &quot;department_id&quot;,
    <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department_id&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;rank&quot;
  <span class="hljs-keyword">FROM</span> &quot;employees&quot;
) <span class="hljs-keyword">AS</span> &quot;employees&quot;
<span class="hljs-keyword">WHERE</span> &quot;rank&quot; <span class="hljs-operator">&lt;=</span> <span class="hljs-number">3</span> <span class="hljs-keyword">AND</span> &quot;department_id&quot; <span class="hljs-operator">=</span> $(deptId)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;rank&quot; <span class="hljs-keyword">ASC</span>
</code></pre>
<h4 id="filtering-with-spread-operator" tabindex="-1"><a class="anchor" href="#filtering-with-spread-operator" aria-hidden="true">#</a> Filtering with Spread Operator</h4>
<p>The spread operator (<code>...e</code>) includes all original columns along with window function results:</p>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PerformanceSchema</span> {
  <span class="hljs-attr">employees</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">performance_score</span>: <span class="hljs-built_in">number</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">PerformanceSchema</span>&gt;();

<span class="hljs-keyword">const</span> topPerformers = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeSelect</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;employees&quot;</span>)
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> ({
        ...e, <span class="hljs-comment">// All original columns</span>
        <span class="hljs-attr">performance_rank</span>: helpers
          .<span class="hljs-title function_">window</span>(e)
          .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">performance_score</span>)
          .<span class="hljs-title function_">rowNumber</span>(),
      }))
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">performance_rank</span> &lt;= <span class="hljs-number">10</span>),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL and SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> (
  <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>, <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;performance_score&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;performance_rank&quot;
  <span class="hljs-keyword">FROM</span> &quot;employees&quot;
) <span class="hljs-keyword">AS</span> &quot;employees&quot;
<span class="hljs-keyword">WHERE</span> &quot;performance_rank&quot; <span class="hljs-operator">&lt;=</span> <span class="hljs-number">10</span>
</code></pre>
<h4 id="combined-filters" tabindex="-1"><a class="anchor" href="#combined-filters" aria-hidden="true">#</a> Combined Filters</h4>
<p>Combine window function filters with regular WHERE conditions:</p>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ActiveEmployeeSchema</span> {
  <span class="hljs-attr">employees</span>: { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">department</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">salary</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">is_active</span>: <span class="hljs-built_in">boolean</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">ActiveEmployeeSchema</span>&gt;();

<span class="hljs-keyword">const</span> activeTopEarners = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeSelect</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;employees&quot;</span>)
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> ({
        <span class="hljs-attr">name</span>: e.<span class="hljs-property">name</span>,
        <span class="hljs-attr">department</span>: e.<span class="hljs-property">department</span>,
        <span class="hljs-attr">salary</span>: e.<span class="hljs-property">salary</span>,
        <span class="hljs-attr">is_active</span>: e.<span class="hljs-property">is_active</span>,
        <span class="hljs-attr">dept_rank</span>: helpers
          .<span class="hljs-title function_">window</span>(e)
          .<span class="hljs-title function_">partitionBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>)
          .<span class="hljs-title function_">orderByDescending</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">salary</span>)
          .<span class="hljs-title function_">rowNumber</span>(),
      }))
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">dept_rank</span> &lt;= <span class="hljs-number">2</span> &amp;&amp; r.<span class="hljs-property">is_active</span> === <span class="hljs-literal">true</span>)
      .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">department</span>)
      .<span class="hljs-title function_">thenBy</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">dept_rank</span>),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL and SQLite (<span class="hljs-doctag">note:</span> is_active filter can be applied before or after window function)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> (
  <span class="hljs-keyword">SELECT</span> &quot;name&quot;, &quot;department&quot;, &quot;salary&quot;, &quot;is_active&quot;,
    <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;salary&quot; <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> &quot;dept_rank&quot;
  <span class="hljs-keyword">FROM</span> &quot;employees&quot;
) <span class="hljs-keyword">AS</span> &quot;employees&quot;
<span class="hljs-keyword">WHERE</span> &quot;dept_rank&quot; <span class="hljs-operator">&lt;=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">AND</span> &quot;is_active&quot; <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;department&quot; <span class="hljs-keyword">ASC</span>, &quot;dept_rank&quot; <span class="hljs-keyword">ASC</span>
</code></pre>
<p><strong>Note</strong>: Tinqer automatically detects when WHERE clauses reference window function columns and wraps the query in a subquery. This transformation is transparent‚Äîyou write natural TypeScript code, and Tinqer generates the correct SQL structure.</p>
<p><strong>Note</strong>: SQLite window function support requires SQLite 3.25 or later.</p>
<hr>
<h2 id="9-scalar-aggregates-on-root-queries" tabindex="-1"><a class="anchor" href="#9-scalar-aggregates-on-root-queries" aria-hidden="true">#</a> 9. Scalar Aggregates on Root Queries</h2>
<p>Aggregate methods can be called directly on queries to return single values.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> totals = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">active</span> === <span class="hljs-literal">true</span>)
      .<span class="hljs-title function_">sum</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">salary</span>),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUM</span>(&quot;salary&quot;) <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;active&quot; <span class="hljs-operator">=</span> $(__p1)
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUM</span>(&quot;salary&quot;) <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;active&quot; <span class="hljs-operator">=</span> @__p1
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">}</span>
</code></pre>
<p>Methods <code>count</code>, <code>average</code>, <code>min</code>, and <code>max</code> follow the same structure. The <code>count</code> method also accepts a predicate:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> activeCount = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">count</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">active</span>)),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;active&quot;
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;active&quot;
</code></pre>
<hr>
<h2 id="10-quantifiers" tabindex="-1"><a class="anchor" href="#10-quantifiers" aria-hidden="true">#</a> 10. Quantifiers</h2>
<p>Methods <code>any</code> and <code>all</code> test whether elements satisfy conditions.</p>
<h3 id="101-any-operation" tabindex="-1"><a class="anchor" href="#101-any-operation" aria-hidden="true">#</a> 10.1 Any Operation</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> hasAdults = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">any</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>)),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;age&quot; <span class="hljs-operator">&gt;=</span> $(__p1)) <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;age&quot; <span class="hljs-operator">&gt;=</span> @__p1) <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">18</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="102-all-operation" tabindex="-1"><a class="anchor" href="#102-all-operation" aria-hidden="true">#</a> 10.2 All Operation</h3>
<p>The <code>all</code> method emits a <code>NOT EXISTS</code> check:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> allActive = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">all</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">active</span> === <span class="hljs-literal">true</span>)),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> (&quot;active&quot; <span class="hljs-operator">=</span> $(__p1))) <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> (&quot;active&quot; <span class="hljs-operator">=</span> @__p1)) <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>
</code></pre>
<hr>
<h3 id="103-contains-operation" tabindex="-1"><a class="anchor" href="#103-contains-operation" aria-hidden="true">#</a> 10.3 Contains Operation</h3>
<p><code>contains(value)</code> is a terminal operation that returns <code>true</code>/<code>false</code>. It requires a scalar <code>.select(...)</code> projection (for example, <code>.select((u) =&gt; u.id)</code>), and is not supported with <code>take()</code>/<code>skip()</code>.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> hasId = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">id</span>)
      .<span class="hljs-title function_">contains</span>(<span class="hljs-number">1</span>),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> &quot;id&quot; <span class="hljs-keyword">AS</span> &quot;__tinqer_value&quot; <span class="hljs-keyword">FROM</span> &quot;users&quot;) <span class="hljs-keyword">AS</span> &quot;__tinqer_contains&quot; <span class="hljs-keyword">WHERE</span> &quot;__tinqer_contains&quot;.&quot;__tinqer_value&quot; <span class="hljs-operator">=</span> $(__p1)) <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> &quot;id&quot; <span class="hljs-keyword">AS</span> &quot;__tinqer_value&quot; <span class="hljs-keyword">FROM</span> &quot;users&quot;) <span class="hljs-keyword">AS</span> &quot;__tinqer_contains&quot; <span class="hljs-keyword">WHERE</span> &quot;__tinqer_contains&quot;.&quot;__tinqer_value&quot; <span class="hljs-operator">=</span> @__p1) <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h2 id="11-element-retrieval" tabindex="-1"><a class="anchor" href="#11-element-retrieval" aria-hidden="true">#</a> 11. Element Retrieval</h2>
<p>Methods <code>first</code>, <code>firstOrDefault</code>, <code>single</code>, <code>singleOrDefault</code>, <code>last</code>, and <code>lastOrDefault</code> retrieve single elements.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> newestUser = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">createdAt</span>)
      .<span class="hljs-title function_">last</span>(),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;createdAt&quot; <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">1</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &quot;createdAt&quot; <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">1</span>
</code></pre>
<ul>
<li><code>single</code> ensures at most one result</li>
<li><code>firstOrDefault</code> / <code>singleOrDefault</code> / <code>lastOrDefault</code> return <code>null</code> when no rows match</li>
<li><code>last</code> and <code>lastOrDefault</code> reverse ordering (or emit <code>ORDER BY 1 DESC</code> when no explicit <code>orderBy</code> exists)</li>
</ul>
<hr>
<h2 id="12-materialisation" tabindex="-1"><a class="anchor" href="#12-materialisation" aria-hidden="true">#</a> 12. Materialisation</h2>
<p>Queries are executed directly without requiring a materialization method. The query builder returns results as arrays by default.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> activeUsers = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeSelect</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">active</span>)
      .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">name</span>),
  {},
);
</code></pre>
<p>The generated SQL matches the entire query chain.</p>
<hr>
<h2 id="13-parameters-and-auto-parameterisation" tabindex="-1"><a class="anchor" href="#13-parameters-and-auto-parameterisation" aria-hidden="true">#</a> 13. Parameters and Auto-Parameterisation</h2>
<p>Tinqer automatically parameterizes all values to prevent SQL injection and enable prepared statements.</p>
<h3 id="131-external-parameter-objects" tabindex="-1"><a class="anchor" href="#131-external-parameter-objects" aria-hidden="true">#</a> 13.1 External Parameter Objects</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> filtered = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { minAge: <span class="hljs-built_in">number</span>; role: <span class="hljs-built_in">string</span> }</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt;= params.<span class="hljs-property">minAge</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">role</span> === params.<span class="hljs-property">role</span>),
  ),
  { <span class="hljs-attr">minAge</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">&quot;manager&quot;</span> },
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;age&quot; <span class="hljs-operator">&gt;=</span> $(minAge) <span class="hljs-keyword">AND</span> &quot;role&quot; <span class="hljs-operator">=</span> $(role)
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;age&quot; <span class="hljs-operator">&gt;=</span> <span class="hljs-variable">@minAge</span> <span class="hljs-keyword">AND</span> &quot;role&quot; <span class="hljs-operator">=</span> <span class="hljs-variable">@role</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;minAge&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;manager&quot;</span> <span class="hljs-punctuation">}</span>
</code></pre>
<p>Nested properties and array indices are preserved (<code>params.filters.departments[0]</code>).</p>
<h3 id="132-literal-auto-parameterisation" tabindex="-1"><a class="anchor" href="#132-literal-auto-parameterisation" aria-hidden="true">#</a> 13.2 Literal Auto-Parameterisation</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> autoParams = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">departmentId</span> === <span class="hljs-number">7</span> &amp;&amp; u.<span class="hljs-property">name</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;A&quot;</span>)),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;departmentId&quot; <span class="hljs-operator">=</span> $(__p1) <span class="hljs-keyword">AND</span> &quot;name&quot; <span class="hljs-keyword">LIKE</span> $(__p2) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;%&#x27;</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;departmentId&quot; <span class="hljs-operator">=</span> @__p1 <span class="hljs-keyword">AND</span> &quot;name&quot; <span class="hljs-keyword">LIKE</span> @__p2 <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;%&#x27;</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;A&quot;</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="133-array-membership" tabindex="-1"><a class="anchor" href="#133-array-membership" aria-hidden="true">#</a> 13.3 Array Membership</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> membership = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">includes</span>(u.<span class="hljs-property">id</span>))),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;id&quot; <span class="hljs-keyword">IN</span> ($(__p1), $(__p2), $(__p3))
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;id&quot; <span class="hljs-keyword">IN</span> (@__p1, @__p2, @__p3)
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__p3&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span> <span class="hljs-punctuation">}</span>
</code></pre>
<p>Parameterized array example:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> dynamicMembership = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { allowed: <span class="hljs-built_in">number</span>[] }</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> params.<span class="hljs-property">allowed</span>.<span class="hljs-title function_">includes</span>(u.<span class="hljs-property">id</span>)),
  ),
  { <span class="hljs-attr">allowed</span>: [<span class="hljs-number">5</span>, <span class="hljs-number">8</span>] },
);
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;allowed[0]&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;allowed[1]&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="134-case-insensitive-helper-functions" tabindex="-1"><a class="anchor" href="#134-case-insensitive-helper-functions" aria-hidden="true">#</a> 13.4 Case-Insensitive Helper Functions</h3>
<pre class="hljs"><code><span class="hljs-keyword">const</span> ic = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> helpers.<span class="hljs-property">functions</span>.<span class="hljs-title function_">icontains</span>(u.<span class="hljs-property">email</span>, <span class="hljs-string">&quot;support&quot;</span>)),
  ),
  {},
);
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">LOWER</span>(&quot;email&quot;) <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-operator">||</span> <span class="hljs-built_in">LOWER</span>($(__p1)) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;%&#x27;</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">LOWER</span>(&quot;email&quot;) <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-operator">||</span> <span class="hljs-built_in">LOWER</span>(@__p1) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;%&#x27;</span>
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;__p1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;support&quot;</span> <span class="hljs-punctuation">}</span>
</code></pre>
<hr>
<h2 id="14-crud-operations" tabindex="-1"><a class="anchor" href="#14-crud-operations" aria-hidden="true">#</a> 14. CRUD Operations</h2>
<p>Tinqer provides full CRUD support with the same type-safety and lambda expression support as SELECT queries. All CRUD operations follow the same pattern: builder functions return operation chains, statement functions generate SQL, and execute functions run the queries.</p>
<h3 id="141-insert-statements" tabindex="-1"><a class="anchor" href="#141-insert-statements" aria-hidden="true">#</a> 14.1 INSERT Statements</h3>
<p>The <code>insertInto</code> function creates INSERT operations. Values are specified using direct object syntax (no lambda wrapping required).</p>
<h4 id="basic-insert" tabindex="-1"><a class="anchor" href="#basic-insert" aria-hidden="true">#</a> Basic INSERT</h4>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema, defineInsert } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { toSql } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-comment">// Insert with literal values - direct object syntax</span>
<span class="hljs-keyword">const</span> insert = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineInsert</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q.<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">values</span>({
      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span>,
      <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;alice@example.com&quot;</span>,
    }),
  ),
  {},
);
</code></pre>
<p>Generated SQL:</p>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">INSERT INTO</span> &quot;users&quot; (&quot;name&quot;, &quot;age&quot;, &quot;email&quot;)
<span class="hljs-keyword">VALUES</span> ($(__p1), $(__p2), $(__p3))

<span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">INSERT INTO</span> &quot;users&quot; (&quot;name&quot;, &quot;age&quot;, &quot;email&quot;)
<span class="hljs-keyword">VALUES</span> (@__p1, @__p2, @__p3)
</code></pre>
<h4 id="insert-with-external-parameters" tabindex="-1"><a class="anchor" href="#insert-with-external-parameters" aria-hidden="true">#</a> INSERT with External Parameters</h4>
<p>External variables must be passed via the params object - closure variables are not supported:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> insert = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineInsert</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { name: <span class="hljs-built_in">string</span>; age: <span class="hljs-built_in">number</span> }</span>) =&gt;</span>
    q.<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">values</span>({
      <span class="hljs-attr">name</span>: params.<span class="hljs-property">name</span>,
      <span class="hljs-attr">age</span>: params.<span class="hljs-property">age</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;default@example.com&quot;</span>,
    }),
  ),
  { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
);
</code></pre>
<p>Generated SQL uses external parameters directly:</p>
<pre class="hljs"><code><span class="hljs-keyword">INSERT INTO</span> &quot;users&quot; (&quot;name&quot;, &quot;age&quot;, &quot;email&quot;)
<span class="hljs-keyword">VALUES</span> ($(name), $(age), $(__p1))  <span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">VALUES</span> (<span class="hljs-variable">@name</span>, <span class="hljs-variable">@age</span>, @__p1)        <span class="hljs-comment">-- SQLite</span>
</code></pre>
<blockquote>
<p><strong>Tip:</strong> When a property in <code>.values()</code> evaluates to <code>undefined</code>, the column is omitted from the INSERT. Explicit <code>null</code> values still emit <code>NULL</code>. The insert throws if every value is <code>undefined</code>.</p>
</blockquote>
<h4 id="insert-upserts-(on-conflict)" tabindex="-1"><a class="anchor" href="#insert-upserts-(on-conflict)" aria-hidden="true">#</a> INSERT Upserts (ON CONFLICT)</h4>
<p>Tinqer supports upserts for PostgreSQL and SQLite via <code>ON CONFLICT</code>. Conflict targets use <strong>typed column selectors</strong> (no string column names). Composite conflict targets are specified by passing multiple selectors: <code>.onConflict((u) =&gt; u.col1, (u) =&gt; u.col2)</code>.</p>
<pre class="hljs"><code><span class="hljs-comment">// Ignore duplicates (ON CONFLICT DO NOTHING)</span>
<span class="hljs-keyword">const</span> upsertIgnore = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineInsert</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { email: <span class="hljs-built_in">string</span>; name: <span class="hljs-built_in">string</span> }</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">values</span>({ <span class="hljs-attr">email</span>: params.<span class="hljs-property">email</span>, <span class="hljs-attr">name</span>: params.<span class="hljs-property">name</span> })
      .<span class="hljs-title function_">onConflict</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">email</span>)
      .<span class="hljs-title function_">doNothing</span>(),
  ),
  { <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;alice@example.com&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> },
);

<span class="hljs-comment">// Update on conflict (ON CONFLICT DO UPDATE SET ...)</span>
<span class="hljs-keyword">const</span> upsertUpdate = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineInsert</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { email: <span class="hljs-built_in">string</span>; name: <span class="hljs-built_in">string</span> }</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">values</span>({ <span class="hljs-attr">email</span>: params.<span class="hljs-property">email</span>, <span class="hljs-attr">name</span>: params.<span class="hljs-property">name</span> })
      .<span class="hljs-title function_">onConflict</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">email</span>)
      .<span class="hljs-title function_">doUpdateSet</span>(<span class="hljs-function">(<span class="hljs-params">_existing, excluded</span>) =&gt;</span> ({
        <span class="hljs-attr">name</span>: excluded.<span class="hljs-property">name</span>,
      })),
  ),
  { <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;alice@example.com&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> },
);
</code></pre>
<p>Generated SQL:</p>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">INSERT INTO</span> &quot;users&quot; (&quot;email&quot;, &quot;name&quot;)
<span class="hljs-keyword">VALUES</span> ($(email), $(name))
<span class="hljs-keyword">ON</span> CONFLICT (&quot;email&quot;) DO NOTHING

<span class="hljs-keyword">INSERT INTO</span> &quot;users&quot; (&quot;email&quot;, &quot;name&quot;)
<span class="hljs-keyword">VALUES</span> ($(email), $(name))
<span class="hljs-keyword">ON</span> CONFLICT (&quot;email&quot;) DO <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">SET</span> &quot;name&quot; <span class="hljs-operator">=</span> EXCLUDED.&quot;name&quot;

<span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">INSERT INTO</span> &quot;users&quot; (&quot;email&quot;, &quot;name&quot;)
<span class="hljs-keyword">VALUES</span> (<span class="hljs-variable">@email</span>, <span class="hljs-variable">@name</span>)
<span class="hljs-keyword">ON</span> CONFLICT (&quot;email&quot;) DO NOTHING

<span class="hljs-keyword">INSERT INTO</span> &quot;users&quot; (&quot;email&quot;, &quot;name&quot;)
<span class="hljs-keyword">VALUES</span> (<span class="hljs-variable">@email</span>, <span class="hljs-variable">@name</span>)
<span class="hljs-keyword">ON</span> CONFLICT (&quot;email&quot;) DO <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">SET</span> &quot;name&quot; <span class="hljs-operator">=</span> excluded.&quot;name&quot;
</code></pre>
<blockquote>
<p><strong>Note:</strong> <code>onConflict(...)</code> must be followed by either <code>.doNothing()</code> or <code>.doUpdateSet(...)</code>.</p>
</blockquote>
<h4 id="insert-with-returning-clause" tabindex="-1"><a class="anchor" href="#insert-with-returning-clause" aria-hidden="true">#</a> INSERT with RETURNING Clause</h4>
<p>Both PostgreSQL and SQLite (3.35.0+) support the RETURNING clause to retrieve values from inserted rows:</p>
<pre class="hljs"><code><span class="hljs-comment">// Return specific columns</span>
<span class="hljs-keyword">const</span> insertWithReturn = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineInsert</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">values</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Charlie&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span> })
      .<span class="hljs-title function_">returning</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> ({ <span class="hljs-attr">id</span>: u.<span class="hljs-property">id</span>, <span class="hljs-attr">createdAt</span>: u.<span class="hljs-property">createdAt</span> })),
  ),
  {},
);

<span class="hljs-comment">// Return all columns</span>
<span class="hljs-keyword">const</span> insertReturnAll = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineInsert</span>(
    schema,
    <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
      q
        .<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>)
        .<span class="hljs-title function_">values</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;David&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">40</span> })
        .<span class="hljs-title function_">returning</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u), <span class="hljs-comment">// Returns *</span>
  ),
  {},
);
</code></pre>
<h4 id="null-values-in-insert" tabindex="-1"><a class="anchor" href="#null-values-in-insert" aria-hidden="true">#</a> NULL Values in INSERT</h4>
<pre class="hljs"><code><span class="hljs-keyword">const</span> insert = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineInsert</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q.<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">values</span>({
      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Eve&quot;</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// Generates NULL, not parameterized</span>
      <span class="hljs-attr">phone</span>: <span class="hljs-literal">undefined</span>, <span class="hljs-comment">// Column omitted from INSERT</span>
    }),
  ),
  {},
);
</code></pre>
<h3 id="142-update-statements" tabindex="-1"><a class="anchor" href="#142-update-statements" aria-hidden="true">#</a> 14.2 UPDATE Statements</h3>
<p>The <code>update</code> function creates UPDATE operations. The <code>.set()</code> method accepts either an object literal or an arrow function returning an object literal (to support column self-reference).</p>
<h4 id="basic-update" tabindex="-1"><a class="anchor" href="#basic-update" aria-hidden="true">#</a> Basic UPDATE</h4>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema, defineUpdate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { toSql } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> updateStmt = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineUpdate</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">set</span>({ <span class="hljs-attr">age</span>: <span class="hljs-number">31</span>, <span class="hljs-attr">lastModified</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() })
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">id</span> === <span class="hljs-number">1</span>),
  ),
  {},
);
</code></pre>
<p>Generated SQL:</p>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">UPDATE</span> &quot;users&quot;
<span class="hljs-keyword">SET</span> &quot;age&quot; <span class="hljs-operator">=</span> $(__p1), &quot;lastModified&quot; <span class="hljs-operator">=</span> $(__p2)
<span class="hljs-keyword">WHERE</span> &quot;id&quot; <span class="hljs-operator">=</span> $(__p3)

<span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">UPDATE</span> &quot;users&quot;
<span class="hljs-keyword">SET</span> &quot;age&quot; <span class="hljs-operator">=</span> @__p1, &quot;lastModified&quot; <span class="hljs-operator">=</span> @__p2
<span class="hljs-keyword">WHERE</span> &quot;id&quot; <span class="hljs-operator">=</span> @__p3
</code></pre>
<blockquote>
<p><strong>Tip:</strong> If any property in the <code>.set()</code> object evaluates to <code>undefined</code> (for example because a parameter was omitted), Tinqer simply skips that column. Explicit <code>null</code> values still generate <code>SET column = NULL</code>. The query builder throws if every assignment resolves to <code>undefined</code>.</p>
</blockquote>
<h4 id="update-with-column-self-reference" tabindex="-1"><a class="anchor" href="#update-with-column-self-reference" aria-hidden="true">#</a> UPDATE with Column Self-Reference</h4>
<pre class="hljs"><code><span class="hljs-keyword">const</span> updateStmt = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineUpdate</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { userId: <span class="hljs-built_in">number</span>; delta: <span class="hljs-built_in">number</span> }</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> ({ <span class="hljs-attr">view_count</span>: u.<span class="hljs-property">view_count</span> + params.<span class="hljs-property">delta</span> }))
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">id</span> === params.<span class="hljs-property">userId</span>),
  ),
  { <span class="hljs-attr">userId</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">delta</span>: <span class="hljs-number">1</span> },
);
</code></pre>
<p>Generated SQL:</p>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">UPDATE</span> &quot;users&quot;
<span class="hljs-keyword">SET</span> &quot;view_count&quot; <span class="hljs-operator">=</span> (&quot;view_count&quot; <span class="hljs-operator">+</span> $(delta))
<span class="hljs-keyword">WHERE</span> &quot;id&quot; <span class="hljs-operator">=</span> $(userId)

<span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">UPDATE</span> &quot;users&quot;
<span class="hljs-keyword">SET</span> &quot;view_count&quot; <span class="hljs-operator">=</span> (&quot;view_count&quot; <span class="hljs-operator">+</span> <span class="hljs-variable">@delta</span>)
<span class="hljs-keyword">WHERE</span> &quot;id&quot; <span class="hljs-operator">=</span> <span class="hljs-variable">@userId</span>
</code></pre>
<h4 id="update-with-external-parameters" tabindex="-1"><a class="anchor" href="#update-with-external-parameters" aria-hidden="true">#</a> UPDATE with External Parameters</h4>
<p>External variables must be passed via the params object:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> updateStmt = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineUpdate</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { newAge: <span class="hljs-built_in">number</span> }</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">set</span>({ <span class="hljs-attr">age</span>: params.<span class="hljs-property">newAge</span> })
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">id</span> === <span class="hljs-number">1</span>),
  ),
  { <span class="hljs-attr">newAge</span>: <span class="hljs-number">32</span> },
);
</code></pre>
<h4 id="update-with-complex-where" tabindex="-1"><a class="anchor" href="#update-with-complex-where" aria-hidden="true">#</a> UPDATE with Complex WHERE</h4>
<pre class="hljs"><code><span class="hljs-keyword">const</span> updateStmt = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineUpdate</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">set</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;inactive&quot;</span> })
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">lastLogin</span> &lt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&quot;2023-01-01&quot;</span>) &amp;&amp; u.<span class="hljs-property">role</span> !== <span class="hljs-string">&quot;admin&quot;</span>),
  ),
  {},
);
</code></pre>
<h4 id="update-with-returning-clause" tabindex="-1"><a class="anchor" href="#update-with-returning-clause" aria-hidden="true">#</a> UPDATE with RETURNING Clause</h4>
<pre class="hljs"><code><span class="hljs-keyword">const</span> updateWithReturn = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineUpdate</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">set</span>({ <span class="hljs-attr">age</span>: <span class="hljs-number">32</span> })
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">id</span> === <span class="hljs-number">2</span>)
      .<span class="hljs-title function_">returning</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> ({ <span class="hljs-attr">id</span>: u.<span class="hljs-property">id</span>, <span class="hljs-attr">age</span>: u.<span class="hljs-property">age</span>, <span class="hljs-attr">updatedAt</span>: u.<span class="hljs-property">updatedAt</span> })),
  ),
  {},
);
</code></pre>
<h4 id="full-table-update-(requires-explicit-permission)" tabindex="-1"><a class="anchor" href="#full-table-update-(requires-explicit-permission)" aria-hidden="true">#</a> Full Table UPDATE (Requires Explicit Permission)</h4>
<pre class="hljs"><code><span class="hljs-comment">// UPDATE without WHERE requires explicit permission</span>
<span class="hljs-keyword">const</span> updateAll = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineUpdate</span>(
    schema,
    <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">set</span>({ <span class="hljs-attr">isActive</span>: <span class="hljs-literal">true</span> }).<span class="hljs-title function_">allowFullTableUpdate</span>(), <span class="hljs-comment">// Required flag</span>
  ),
  {},
);
</code></pre>
<p>Without the flag, attempting an UPDATE without WHERE throws an error:</p>
<pre class="hljs"><code>Error: UPDATE requires a WHERE clause or explicit allowFullTableUpdate().
Full table updates are dangerous and must be explicitly allowed.
</code></pre>
<h3 id="143-delete-statements" tabindex="-1"><a class="anchor" href="#143-delete-statements" aria-hidden="true">#</a> 14.3 DELETE Statements</h3>
<p>The <code>deleteFrom</code> function creates DELETE operations with optional WHERE conditions.</p>
<h4 id="basic-delete" tabindex="-1"><a class="anchor" href="#basic-delete" aria-hidden="true">#</a> Basic DELETE</h4>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema, defineDelete } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { toSql } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> del = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineDelete</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">deleteFrom</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt; <span class="hljs-number">100</span>)),
  {},
);
</code></pre>
<p>Generated SQL:</p>
<pre class="hljs"><code><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;age&quot; <span class="hljs-operator">&gt;</span> $(__p1)  <span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> &quot;users&quot; <span class="hljs-keyword">WHERE</span> &quot;age&quot; <span class="hljs-operator">&gt;</span> @__p1    <span class="hljs-comment">-- SQLite</span>
</code></pre>
<h4 id="delete-with-complex-conditions" tabindex="-1"><a class="anchor" href="#delete-with-complex-conditions" aria-hidden="true">#</a> DELETE with Complex Conditions</h4>
<pre class="hljs"><code><span class="hljs-keyword">const</span> del = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineDelete</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">deleteFrom</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">isDeleted</span> === <span class="hljs-literal">true</span> || (u.<span class="hljs-property">age</span> &lt; <span class="hljs-number">18</span> &amp;&amp; u.<span class="hljs-property">role</span> !== <span class="hljs-string">&quot;admin&quot;</span>) || u.<span class="hljs-property">email</span> === <span class="hljs-literal">null</span>),
  ),
  {},
);
</code></pre>
<h4 id="delete-with-in-clause" tabindex="-1"><a class="anchor" href="#delete-with-in-clause" aria-hidden="true">#</a> DELETE with IN Clause</h4>
<pre class="hljs"><code><span class="hljs-keyword">const</span> del = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineDelete</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { userIds: <span class="hljs-built_in">number</span>[] }</span>) =&gt;</span>
    q.<span class="hljs-title function_">deleteFrom</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> params.<span class="hljs-property">userIds</span>.<span class="hljs-title function_">includes</span>(u.<span class="hljs-property">id</span>)),
  ),
  { <span class="hljs-attr">userIds</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>] },
);
</code></pre>
<p>Generated SQL:</p>
<pre class="hljs"><code><span class="hljs-comment">-- PostgreSQL</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> &quot;users&quot;
<span class="hljs-keyword">WHERE</span> &quot;id&quot; <span class="hljs-keyword">IN</span> ($(userIds_0), $(userIds_1), $(userIds_2), $(userIds_3), $(userIds_4))

<span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> &quot;users&quot;
<span class="hljs-keyword">WHERE</span> &quot;id&quot; <span class="hljs-keyword">IN</span> (<span class="hljs-variable">@userIds_0</span>, <span class="hljs-variable">@userIds_1</span>, <span class="hljs-variable">@userIds_2</span>, <span class="hljs-variable">@userIds_3</span>, <span class="hljs-variable">@userIds_4</span>)
</code></pre>
<pre class="hljs"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;userIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span> <span class="hljs-number">5</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;userIds_0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;userIds_1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;userIds_2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;userIds_3&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;userIds_4&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 id="full-table-delete-(requires-explicit-permission)" tabindex="-1"><a class="anchor" href="#full-table-delete-(requires-explicit-permission)" aria-hidden="true">#</a> Full Table DELETE (Requires Explicit Permission)</h4>
<pre class="hljs"><code><span class="hljs-comment">// DELETE without WHERE requires explicit permission</span>
<span class="hljs-keyword">const</span> deleteAll = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineDelete</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">deleteFrom</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">allowFullTableDelete</span>()), <span class="hljs-comment">// Required flag</span>
  {},
);
</code></pre>
<h3 id="144-safety-features" tabindex="-1"><a class="anchor" href="#144-safety-features" aria-hidden="true">#</a> 14.4 Safety Features</h3>
<p>Tinqer includes multiple safety guards for CRUD operations:</p>
<h4 id="mandatory-where-clauses" tabindex="-1"><a class="anchor" href="#mandatory-where-clauses" aria-hidden="true">#</a> Mandatory WHERE Clauses</h4>
<p>UPDATE and DELETE operations require WHERE clauses by default to prevent accidental full-table operations:</p>
<pre class="hljs"><code><span class="hljs-comment">// This throws an error</span>
<span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineDelete</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">deleteFrom</span>(<span class="hljs-string">&quot;users&quot;</span>)),
  {},
);
<span class="hljs-comment">// Error: DELETE requires a WHERE clause or explicit allowFullTableDelete()</span>

<span class="hljs-comment">// This works</span>
<span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineDelete</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">deleteFrom</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">allowFullTableDelete</span>()),
  {},
);
</code></pre>
<h4 id="type-safety" tabindex="-1"><a class="anchor" href="#type-safety" aria-hidden="true">#</a> Type Safety</h4>
<p>All CRUD operations maintain full TypeScript type safety:</p>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserSchema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">UserSchema</span>&gt;();

<span class="hljs-comment">// Type error: &#x27;username&#x27; doesn&#x27;t exist on users table</span>
<span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineInsert</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q.<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">values</span>({
      <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-comment">// ‚ùå Type error</span>
    }),
  ),
  {},
);

<span class="hljs-comment">// Type error: age must be number</span>
<span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineUpdate</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q.<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">set</span>({
      <span class="hljs-attr">age</span>: <span class="hljs-string">&quot;30&quot;</span>, <span class="hljs-comment">// ‚ùå Type error - must be number</span>
    }),
  ),
  {},
);
</code></pre>
<h4 id="parameter-sanitization" tabindex="-1"><a class="anchor" href="#parameter-sanitization" aria-hidden="true">#</a> Parameter Sanitization</h4>
<p>All values are automatically parameterized to prevent SQL injection:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> maliciousName = <span class="hljs-string">&quot;&#x27;; DROP TABLE users; --&quot;</span>;
<span class="hljs-keyword">const</span> insert = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineInsert</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q.<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">values</span>({
      <span class="hljs-attr">name</span>: maliciousName, <span class="hljs-comment">// Safely parameterized</span>
    }),
  ),
  {},
);
<span class="hljs-comment">// Generates: INSERT INTO &quot;users&quot; (&quot;name&quot;) VALUES ($(__p1))</span>
<span class="hljs-comment">// Parameters: { __p1: &quot;&#x27;; DROP TABLE users; --&quot; }</span>
</code></pre>
<h3 id="145-executing-crud-operations" tabindex="-1"><a class="anchor" href="#145-executing-crud-operations" aria-hidden="true">#</a> 14.5 Executing CRUD Operations</h3>
<p>The adapter packages provide execution functions for all CRUD operations:</p>
<h4 id="postgresql-(pg-promise)" tabindex="-1"><a class="anchor" href="#postgresql-(pg-promise)" aria-hidden="true">#</a> PostgreSQL (pg-promise)</h4>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { executeInsert, executeUpdate, executeDelete } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-comment">// Execute INSERT with RETURNING</span>
<span class="hljs-keyword">const</span> insertedUsers = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeInsert</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">values</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Frank&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span> })
      .<span class="hljs-title function_">returning</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> ({ <span class="hljs-attr">id</span>: u.<span class="hljs-property">id</span>, <span class="hljs-attr">name</span>: u.<span class="hljs-property">name</span> })),
  {},
);
<span class="hljs-comment">// Returns: [{ id: 123, name: &quot;Frank&quot; }]</span>

<span class="hljs-comment">// Execute UPDATE - returns affected row count</span>
<span class="hljs-keyword">const</span> updateCount = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeUpdate</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">set</span>({ <span class="hljs-attr">age</span>: <span class="hljs-number">29</span> })
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">id</span> === <span class="hljs-number">123</span>),
  {},
);
<span class="hljs-comment">// Returns number of affected rows</span>

<span class="hljs-comment">// Execute DELETE - returns affected row count</span>
<span class="hljs-keyword">const</span> deleteCount = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeDelete</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">deleteFrom</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">id</span> === <span class="hljs-number">123</span>),
  {},
);
</code></pre>
<h4 id="sqlite-(better-sqlite3)" tabindex="-1"><a class="anchor" href="#sqlite-(better-sqlite3)" aria-hidden="true">#</a> SQLite (better-sqlite3)</h4>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { executeInsert, executeUpdate, executeDelete } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/better-sqlite3-adapter&quot;</span>;

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-comment">// Execute INSERT - returns row count</span>
<span class="hljs-keyword">const</span> insertCount = <span class="hljs-title function_">executeInsert</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">values</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Grace&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }),
  {},
);
<span class="hljs-comment">// Returns number of inserted rows</span>

<span class="hljs-comment">// Execute UPDATE - returns row count</span>
<span class="hljs-keyword">const</span> updateCount = <span class="hljs-title function_">executeUpdate</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">set</span>({ <span class="hljs-attr">age</span>: <span class="hljs-number">33</span> })
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">name</span> === <span class="hljs-string">&quot;Henry&quot;</span>),
  {},
);

<span class="hljs-comment">// Execute DELETE - returns row count</span>
<span class="hljs-keyword">const</span> deleteCount = <span class="hljs-title function_">executeDelete</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">deleteFrom</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt; <span class="hljs-number">100</span>),
  {},
);
</code></pre>
<p>SQLite helpers always return the number of affected rows. To inspect row data after an insert or update, run a follow-up SELECT query using <code>executeSelect</code>.</p>
<h4 id="transaction-support" tabindex="-1"><a class="anchor" href="#transaction-support" aria-hidden="true">#</a> Transaction Support</h4>
<p>Both adapters support transactions through their respective database drivers:</p>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">TxSchema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">lastLogin</span>: <span class="hljs-title class_">Date</span> };
  <span class="hljs-attr">user_logs</span>: { <span class="hljs-attr">userId</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">action</span>: <span class="hljs-built_in">string</span> };
}
<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">TxSchema</span>&gt;();

<span class="hljs-comment">// PostgreSQL transactions</span>
<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">tx</span>(<span class="hljs-title function_">async</span> (t) =&gt; {
  <span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeInsert</span>(
    t,
    schema,
    <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
      q
        .<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>)
        .<span class="hljs-title function_">values</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Ivy&quot;</span> })
        .<span class="hljs-title function_">returning</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">id</span>),
    {},
  );

  <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeInsert</span>(
    t,
    schema,
    <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
      q.<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;user_logs&quot;</span>).<span class="hljs-title function_">values</span>({
        <span class="hljs-attr">userId</span>: users[<span class="hljs-number">0</span>]!.<span class="hljs-property">id</span>,
        <span class="hljs-attr">action</span>: <span class="hljs-string">&quot;created&quot;</span>,
      }),
    {},
  );
});

<span class="hljs-comment">// SQLite transactions</span>
<span class="hljs-keyword">const</span> transaction = sqliteDb.<span class="hljs-title function_">transaction</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">executeInsert</span>(db, schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">values</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Jack&quot;</span> }), {});
  <span class="hljs-title function_">executeUpdate</span>(
    db,
    schema,
    <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
      q
        .<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>)
        .<span class="hljs-title function_">set</span>({ <span class="hljs-attr">lastLogin</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() })
        .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">name</span> === <span class="hljs-string">&quot;Jack&quot;</span>),
    {},
  );
});
<span class="hljs-title function_">transaction</span>();
</code></pre>
<hr>
<h2 id="15-query-composition-and-reusability" tabindex="-1"><a class="anchor" href="#15-query-composition-and-reusability" aria-hidden="true">#</a> 15. Query Composition and Reusability</h2>
<p>Tinqer query plans are <strong>immutable and composable</strong>. Plan handles returned by <code>define*</code> functions support method chaining - each operation returns a new plan without modifying the original. This enables powerful query composition patterns: reusable base queries, branching specialized variations, and parameter accumulation.</p>
<h3 id="151-chaining-operations-on-plans" tabindex="-1"><a class="anchor" href="#151-chaining-operations-on-plans" aria-hidden="true">#</a> 15.1 Chaining Operations on Plans</h3>
<p>All plan handles support chaining operations like <code>where()</code>, <code>orderBy()</code>, <code>select()</code>, etc.:</p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema, defineSelect } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { toSql } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">isActive</span>: <span class="hljs-built_in">boolean</span> };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-comment">// Chain operations on the plan handle</span>
<span class="hljs-keyword">const</span> plan = <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>))
  .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt; <span class="hljs-number">18</span>)
  .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">isActive</span> === <span class="hljs-literal">true</span>)
  .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">name</span>)
  .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> ({ <span class="hljs-attr">id</span>: u.<span class="hljs-property">id</span>, <span class="hljs-attr">name</span>: u.<span class="hljs-property">name</span> }));

<span class="hljs-keyword">const</span> { sql, params } = <span class="hljs-title function_">toSql</span>(plan, {});
<span class="hljs-comment">// SELECT &quot;id&quot; AS &quot;id&quot;, &quot;name&quot; AS &quot;name&quot; FROM &quot;users&quot;</span>
<span class="hljs-comment">// WHERE &quot;age&quot; &gt; $(__p1) AND &quot;isActive&quot; = $(__p2)</span>
<span class="hljs-comment">// ORDER BY &quot;name&quot; ASC</span>
</code></pre>
<h3 id="152-immutability-and-base-queries" tabindex="-1"><a class="anchor" href="#152-immutability-and-base-queries" aria-hidden="true">#</a> 15.2 Immutability and Base Queries</h3>
<p>Plans are immutable - calling a method returns a <strong>new plan</strong> without modifying the original:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> basePlan = <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>));

<span class="hljs-keyword">const</span> withAge = basePlan.<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt; <span class="hljs-number">18</span>);
<span class="hljs-keyword">const</span> withStatus = basePlan.<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">isActive</span> === <span class="hljs-literal">true</span>);

<span class="hljs-comment">// basePlan is unchanged</span>
<span class="hljs-comment">// withAge and withStatus are independent plans</span>
</code></pre>
<p>This immutability enables creating <strong>reusable base queries</strong>:</p>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">orders</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">userId</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">total</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>;
  };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-comment">// Reusable base query</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserOrdersParams</span> = { <span class="hljs-attr">userId</span>: <span class="hljs-built_in">number</span> };

<span class="hljs-keyword">const</span> userOrders = <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">p</span>: <span class="hljs-title class_">UserOrdersParams</span></span>) =&gt;</span>
  q
    .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;orders&quot;</span>)
    .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">o</span>) =&gt;</span> o.<span class="hljs-property">userId</span> === p.<span class="hljs-property">userId</span>)
    .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">o</span>) =&gt;</span> o.<span class="hljs-property">createdAt</span>),
);

<span class="hljs-comment">// Use the base query in different contexts</span>
<span class="hljs-keyword">const</span> recentUserOrders = userOrders.<span class="hljs-title function_">take</span>(<span class="hljs-number">10</span>);
<span class="hljs-keyword">const</span> highValueUserOrders = userOrders.<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">o</span>) =&gt;</span> o.<span class="hljs-property">total</span> &gt; <span class="hljs-number">1000</span>);

<span class="hljs-comment">// Execute with parameters</span>
<span class="hljs-title function_">toSql</span>(recentUserOrders, { <span class="hljs-attr">userId</span>: <span class="hljs-number">42</span> });
<span class="hljs-title function_">toSql</span>(highValueUserOrders, { <span class="hljs-attr">userId</span>: <span class="hljs-number">42</span> });
</code></pre>
<h3 id="153-branching-from-base-queries" tabindex="-1"><a class="anchor" href="#153-branching-from-base-queries" aria-hidden="true">#</a> 15.3 Branching from Base Queries</h3>
<p>Since plans are immutable, you can branch multiple specialized queries from a single base:</p>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">isActive</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">departmentId</span>: <span class="hljs-built_in">number</span>;
  };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeptParams</span> = { <span class="hljs-attr">departmentId</span>: <span class="hljs-built_in">number</span> };

<span class="hljs-comment">// Base query: users in a department</span>
<span class="hljs-keyword">const</span> usersInDept = <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">p</span>: <span class="hljs-title class_">DeptParams</span></span>) =&gt;</span>
  q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">departmentId</span> === p.<span class="hljs-property">departmentId</span>),
);

<span class="hljs-comment">// Branch 1: Active users only</span>
<span class="hljs-keyword">const</span> activeUsersInDept = usersInDept
  .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">isActive</span> === <span class="hljs-literal">true</span>)
  .<span class="hljs-property">where</span>&lt;{ <span class="hljs-attr">minAge</span>: <span class="hljs-built_in">number</span> }&gt;(<span class="hljs-function">(<span class="hljs-params">u, p</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt;= p.<span class="hljs-property">minAge</span>)
  .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">name</span>);

<span class="hljs-comment">// Branch 2: Inactive users only</span>
<span class="hljs-keyword">const</span> inactiveUsersInDept = usersInDept
  .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">isActive</span> === <span class="hljs-literal">false</span>)
  .<span class="hljs-property">where</span>&lt;{ <span class="hljs-attr">maxAge</span>: <span class="hljs-built_in">number</span> }&gt;(<span class="hljs-function">(<span class="hljs-params">u, p</span>) =&gt;</span> u.<span class="hljs-property">age</span> &lt;= p.<span class="hljs-property">maxAge</span>)
  .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span>);

<span class="hljs-comment">// Branch 3: Senior staff</span>
<span class="hljs-keyword">const</span> seniorStaffInDept = usersInDept
  .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">50</span>)
  .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> ({ <span class="hljs-attr">id</span>: u.<span class="hljs-property">id</span>, <span class="hljs-attr">name</span>: u.<span class="hljs-property">name</span>, <span class="hljs-attr">age</span>: u.<span class="hljs-property">age</span> }));

<span class="hljs-comment">// Execute branches with different parameters</span>
<span class="hljs-title function_">toSql</span>(activeUsersInDept, { <span class="hljs-attr">departmentId</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">minAge</span>: <span class="hljs-number">25</span> });
<span class="hljs-title function_">toSql</span>(inactiveUsersInDept, { <span class="hljs-attr">departmentId</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">maxAge</span>: <span class="hljs-number">65</span> });
<span class="hljs-title function_">toSql</span>(seniorStaffInDept, { <span class="hljs-attr">departmentId</span>: <span class="hljs-number">1</span> });
</code></pre>
<h3 id="154-parameter-accumulation" tabindex="-1"><a class="anchor" href="#154-parameter-accumulation" aria-hidden="true">#</a> 15.4 Parameter Accumulation</h3>
<p>Parameters from the builder function and chained operations are <strong>merged automatically</strong>:</p>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">products</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">category</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">inStock</span>: <span class="hljs-built_in">boolean</span>;
  };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-comment">// Builder function defines initial params</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">BuilderParams</span> = { <span class="hljs-attr">category</span>: <span class="hljs-built_in">string</span> };

<span class="hljs-keyword">const</span> plan = <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">p</span>: <span class="hljs-title class_">BuilderParams</span></span>) =&gt;</span>
  q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;products&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">prod</span>) =&gt;</span> prod.<span class="hljs-property">category</span> === p.<span class="hljs-property">category</span>),
);

<span class="hljs-comment">// Chained operations add more params</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ChainParams1</span> = { <span class="hljs-attr">minPrice</span>: <span class="hljs-built_in">number</span> };
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ChainParams2</span> = { <span class="hljs-attr">maxPrice</span>: <span class="hljs-built_in">number</span> };

<span class="hljs-keyword">const</span> refinedPlan = plan
  .<span class="hljs-property">where</span>&lt;<span class="hljs-title class_">ChainParams1</span>&gt;(<span class="hljs-function">(<span class="hljs-params">prod, p</span>) =&gt;</span> prod.<span class="hljs-property">price</span> &gt;= p.<span class="hljs-property">minPrice</span>)
  .<span class="hljs-property">where</span>&lt;<span class="hljs-title class_">ChainParams2</span>&gt;(<span class="hljs-function">(<span class="hljs-params">prod, p</span>) =&gt;</span> prod.<span class="hljs-property">price</span> &lt;= p.<span class="hljs-property">maxPrice</span>)
  .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">prod</span>) =&gt;</span> prod.<span class="hljs-property">inStock</span> === <span class="hljs-literal">true</span>);

<span class="hljs-comment">// Must provide ALL accumulated parameters</span>
<span class="hljs-keyword">const</span> { sql, params } = <span class="hljs-title function_">toSql</span>(refinedPlan, {
  <span class="hljs-attr">category</span>: <span class="hljs-string">&quot;electronics&quot;</span>,
  <span class="hljs-attr">minPrice</span>: <span class="hljs-number">100</span>,
  <span class="hljs-attr">maxPrice</span>: <span class="hljs-number">1000</span>,
});

<span class="hljs-comment">// params contains: { category, minPrice, maxPrice, __p1: true }</span>
</code></pre>
<p><strong>Type safety</strong>: TypeScript enforces that all accumulated parameters are provided at execution time.</p>
<h3 id="155-composition-with-all-operations" tabindex="-1"><a class="anchor" href="#155-composition-with-all-operations" aria-hidden="true">#</a> 15.5 Composition with All Operations</h3>
<p>Composition works with all CRUD operations, not just SELECT:</p>
<h4 id="insert-composition" tabindex="-1"><a class="anchor" href="#insert-composition" aria-hidden="true">#</a> INSERT Composition</h4>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">posts</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">userId</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">isPublished</span>: <span class="hljs-built_in">boolean</span>;
  };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> insertPost = <span class="hljs-title function_">defineInsert</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;posts&quot;</span>))
  .<span class="hljs-title function_">values</span>({
    <span class="hljs-attr">userId</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;My Post&quot;</span>,
    <span class="hljs-attr">content</span>: <span class="hljs-string">&quot;Post content&quot;</span>,
    <span class="hljs-attr">isPublished</span>: <span class="hljs-literal">false</span>,
  })
  .<span class="hljs-title function_">returning</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> ({ <span class="hljs-attr">id</span>: p.<span class="hljs-property">id</span>, <span class="hljs-attr">title</span>: p.<span class="hljs-property">title</span> }));

<span class="hljs-title function_">toSql</span>(insertPost, {});
</code></pre>
<h4 id="update-composition" tabindex="-1"><a class="anchor" href="#update-composition" aria-hidden="true">#</a> UPDATE Composition</h4>
<pre class="hljs"><code><span class="hljs-keyword">const</span> updatePlan = <span class="hljs-title function_">defineUpdate</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;posts&quot;</span>))
  .<span class="hljs-title function_">set</span>({ <span class="hljs-attr">isPublished</span>: <span class="hljs-literal">true</span> })
  .<span class="hljs-property">where</span>&lt;{ <span class="hljs-attr">minViews</span>: <span class="hljs-built_in">number</span> }&gt;(<span class="hljs-function">(<span class="hljs-params">p, params</span>) =&gt;</span> p.<span class="hljs-property">viewCount</span> &gt; params.<span class="hljs-property">minViews</span>)
  .<span class="hljs-title function_">returning</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> p.<span class="hljs-property">id</span>);

<span class="hljs-title function_">toSql</span>(updatePlan, { <span class="hljs-attr">minViews</span>: <span class="hljs-number">1000</span> });
</code></pre>
<h4 id="delete-composition" tabindex="-1"><a class="anchor" href="#delete-composition" aria-hidden="true">#</a> DELETE Composition</h4>
<pre class="hljs"><code><span class="hljs-keyword">const</span> deletePlan = <span class="hljs-title function_">defineDelete</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">deleteFrom</span>(<span class="hljs-string">&quot;posts&quot;</span>))
  .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> p.<span class="hljs-property">isPublished</span> === <span class="hljs-literal">false</span>)
  .<span class="hljs-property">where</span>&lt;{ <span class="hljs-attr">beforeDate</span>: <span class="hljs-title class_">Date</span> }&gt;(<span class="hljs-function">(<span class="hljs-params">p, params</span>) =&gt;</span> p.<span class="hljs-property">createdAt</span> &lt; params.<span class="hljs-property">beforeDate</span>);

<span class="hljs-title function_">toSql</span>(deletePlan, { <span class="hljs-attr">beforeDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&quot;2024-01-01&quot;</span>) });
</code></pre>
<h3 id="156-practical-patterns" tabindex="-1"><a class="anchor" href="#156-practical-patterns" aria-hidden="true">#</a> 15.6 Practical Patterns</h3>
<h4 id="pattern-1%3A-pagination-helper" tabindex="-1"><a class="anchor" href="#pattern-1%3A-pagination-helper" aria-hidden="true">#</a> Pattern 1: Pagination Helper</h4>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">articles</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>;
    <span class="hljs-attr">viewCount</span>: <span class="hljs-built_in">number</span>;
  };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PageParams</span> = { <span class="hljs-attr">page</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span> };

<span class="hljs-keyword">function</span> paginate&lt;<span class="hljs-title class_">TPlan</span> <span class="hljs-keyword">extends</span> { <span class="hljs-attr">skip</span>: <span class="hljs-title class_">Function</span>; <span class="hljs-attr">take</span>: <span class="hljs-title class_">Function</span> }&gt;(
  <span class="hljs-attr">plan</span>: <span class="hljs-title class_">TPlan</span>,
  <span class="hljs-attr">page</span>: <span class="hljs-built_in">number</span>,
  <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span>,
): <span class="hljs-title class_">TPlan</span> {
  <span class="hljs-keyword">return</span> plan.<span class="hljs-title function_">skip</span>((page - <span class="hljs-number">1</span>) * pageSize).<span class="hljs-title function_">take</span>(pageSize) <span class="hljs-keyword">as</span> <span class="hljs-title class_">TPlan</span>;
}

<span class="hljs-keyword">const</span> allArticles = <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;articles&quot;</span>).<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.<span class="hljs-property">createdAt</span>));

<span class="hljs-comment">// Page 1</span>
<span class="hljs-keyword">const</span> page1 = <span class="hljs-title function_">paginate</span>(allArticles, <span class="hljs-number">1</span>, <span class="hljs-number">20</span>);
<span class="hljs-title function_">toSql</span>(page1, {});

<span class="hljs-comment">// Page 2</span>
<span class="hljs-keyword">const</span> page2 = <span class="hljs-title function_">paginate</span>(allArticles, <span class="hljs-number">2</span>, <span class="hljs-number">20</span>);
<span class="hljs-title function_">toSql</span>(page2, {});
</code></pre>
<h4 id="pattern-2%3A-common-filters" tabindex="-1"><a class="anchor" href="#pattern-2%3A-common-filters" aria-hidden="true">#</a> Pattern 2: Common Filters</h4>
<pre class="hljs"><code><span class="hljs-keyword">const</span> activeArticles = <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span>
  q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;articles&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.<span class="hljs-property">isActive</span> === <span class="hljs-literal">true</span>),
);

<span class="hljs-keyword">const</span> popularActiveArticles = activeArticles.<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.<span class="hljs-property">viewCount</span> &gt; <span class="hljs-number">1000</span>);

<span class="hljs-keyword">const</span> recentActiveArticles = activeArticles
  .<span class="hljs-property">where</span>&lt;{ <span class="hljs-attr">since</span>: <span class="hljs-title class_">Date</span> }&gt;(<span class="hljs-function">(<span class="hljs-params">a, p</span>) =&gt;</span> a.<span class="hljs-property">createdAt</span> &gt;= p.<span class="hljs-property">since</span>)
  .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.<span class="hljs-property">createdAt</span>);

<span class="hljs-title function_">toSql</span>(popularActiveArticles, {});
<span class="hljs-title function_">toSql</span>(recentActiveArticles, { <span class="hljs-attr">since</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&quot;2024-01-01&quot;</span>) });
</code></pre>
<h4 id="pattern-3%3A-repository-pattern" tabindex="-1"><a class="anchor" href="#pattern-3%3A-repository-pattern" aria-hidden="true">#</a> Pattern 3: Repository Pattern</h4>
<pre class="hljs"><code><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span> {
  <span class="hljs-keyword">private</span> baseQuery = <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>));

  <span class="hljs-title function_">findActive</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseQuery</span>.<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">isActive</span> === <span class="hljs-literal">true</span>);
  }

  <span class="hljs-title function_">findByDepartment</span>(<span class="hljs-params"><span class="hljs-attr">deptId</span>: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseQuery</span>.<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">departmentId</span> === deptId);
  }

  <span class="hljs-title function_">findActiveInDepartment</span>(<span class="hljs-params"><span class="hljs-attr">deptId</span>: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findActive</span>().<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">departmentId</span> === deptId);
  }
}

<span class="hljs-keyword">const</span> repo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRepository</span>();
<span class="hljs-title function_">toSql</span>(repo.<span class="hljs-title function_">findActive</span>(), {});
<span class="hljs-title function_">toSql</span>(repo.<span class="hljs-title function_">findActiveInDepartment</span>(<span class="hljs-number">5</span>), {});
</code></pre>
<p><strong>Key Takeaway</strong>: Query composition enables building reusable, composable query fragments that can be combined and specialized without duplication.</p>
<hr>
<h2 id="16-row-filters" tabindex="-1"><a class="anchor" href="#16-row-filters" aria-hidden="true">#</a> 16. Row Filters</h2>
<p>Row filters let you attach row-level predicates to a schema so that SELECT/UPDATE/DELETE automatically include them. This is useful for authorization scoping, and can provide an RLS-like safety net even on databases without native RLS support.</p>
<h3 id="161-basic-usage" tabindex="-1"><a class="anchor" href="#161-basic-usage" aria-hidden="true">#</a> 16.1 Basic Usage</h3>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">orgId</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span> };
  <span class="hljs-attr">posts</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">orgId</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> };
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">ScopeContext</span> = { <span class="hljs-attr">orgId</span>: <span class="hljs-built_in">number</span> };

<span class="hljs-keyword">const</span> dangerousUnrestrictedSchema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> rowFilteredSchema = dangerousUnrestrictedSchema.<span class="hljs-property">withRowFilters</span>&lt;<span class="hljs-title class_">ScopeContext</span>&gt;({
  <span class="hljs-attr">users</span>: <span class="hljs-function">(<span class="hljs-params">u, ctx</span>) =&gt;</span> u.<span class="hljs-property">orgId</span> === ctx.<span class="hljs-property">orgId</span>,
  <span class="hljs-attr">posts</span>: <span class="hljs-function">(<span class="hljs-params">p, ctx</span>) =&gt;</span> p.<span class="hljs-property">orgId</span> === ctx.<span class="hljs-property">orgId</span>,
});

<span class="hljs-keyword">const</span> schema = rowFilteredSchema.<span class="hljs-title function_">withContext</span>({ <span class="hljs-attr">orgId</span>: <span class="hljs-number">7</span> });
</code></pre>
<p>Use <code>schema</code> anywhere you would normally pass a <code>DatabaseSchema</code> (execution or plan APIs). Any SELECT/UPDATE/DELETE built from it will include the filter automatically.</p>
<h3 id="162-per-operation-filters" tabindex="-1"><a class="anchor" href="#162-per-operation-filters" aria-hidden="true">#</a> 16.2 Per-Operation Filters</h3>
<p>You can define different filters per operation, or disable filtering for a specific table by using <code>null</code>.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> schemaWithPolicies = dangerousUnrestrictedSchema.<span class="hljs-property">withRowFilters</span>&lt;<span class="hljs-title class_">ScopeContext</span>&gt;({
  <span class="hljs-attr">users</span>: {
    <span class="hljs-attr">select</span>: <span class="hljs-function">(<span class="hljs-params">u, ctx</span>) =&gt;</span> u.<span class="hljs-property">orgId</span> === ctx.<span class="hljs-property">orgId</span>,
    <span class="hljs-attr">update</span>: <span class="hljs-function">(<span class="hljs-params">u, ctx</span>) =&gt;</span> u.<span class="hljs-property">orgId</span> === ctx.<span class="hljs-property">orgId</span>,
    <span class="hljs-attr">delete</span>: <span class="hljs-function">(<span class="hljs-params">u, ctx</span>) =&gt;</span> u.<span class="hljs-property">orgId</span> === ctx.<span class="hljs-property">orgId</span>,
  },
  <span class="hljs-attr">posts</span>: <span class="hljs-function">(<span class="hljs-params">p, ctx</span>) =&gt;</span> p.<span class="hljs-property">orgId</span> === ctx.<span class="hljs-property">orgId</span>,
});
</code></pre>
<h3 id="163-behavior-notes" tabindex="-1"><a class="anchor" href="#163-behavior-notes" aria-hidden="true">#</a> 16.3 Behavior Notes</h3>
<ul>
<li>Row filters are enforced for SELECT/UPDATE/DELETE only (not required for INSERT).</li>
<li>Row-filtered schemas require <code>.withContext(...)</code> before SELECT/UPDATE/DELETE; otherwise query generation throws (fail closed).</li>
<li>For left joins, row filters are applied inside derived tables to preserve outer join semantics.</li>
<li>For updates, an additional safety predicate is applied so updates can‚Äôt ‚Äúmove‚Äù a row outside of the allowed filter scope via SET.</li>
</ul>
<p><a href="../README.md">‚Üê Back to README</a></p>

      </article>

      <nav class="toc">
<h2>On This Page</h2>
<ul>
  <li><a href="#table-of-contents">Table of Contents</a></li>
  <li><a href="#1-filtering-operations">1. Filtering Operations</a></li>
  <li class="toc-sub"><a href="#11-basic-comparison">1.1 Basic Comparison</a></li>
  <li class="toc-sub"><a href="#12-multiple-predicates">1.2 Multiple Predicates</a></li>
  <li class="toc-sub"><a href="#13-logical-nesting-and-arithmetic">1.3 Logical Nesting and Arithmetic</a></li>
  <li class="toc-sub"><a href="#14-null-checks-and-null-coalescing">1.4 Null Checks and Null Coalescing</a></li>
  <li class="toc-sub"><a href="#15-string-operations">1.5 String Operations</a></li>
  <li class="toc-sub"><a href="#16-case-insensitive-helpers">1.6 Case-Insensitive Helpers</a></li>
  <li class="toc-sub"><a href="#17-array-membership-(in)">1.7 Array Membership (IN)</a></li>
  <li class="toc-sub"><a href="#18-combined-filter-example">1.8 Combined Filter Example</a></li>
  <li><a href="#2-projections">2. Projections</a></li>
  <li class="toc-sub"><a href="#21-full-row-projection">2.1 Full Row Projection</a></li>
  <li class="toc-sub"><a href="#22-object-projection">2.2 Object Projection</a></li>
  <li class="toc-sub"><a href="#23-projection-with-null-coalescing-and-arithmetic">2.3 Projection with Null Coalescing and Arithmetic</a></li>
  <li><a href="#3-ordering">3. Ordering</a></li>
  <li class="toc-sub"><a href="#31-single-key-ascending">3.1 Single Key Ascending</a></li>
  <li class="toc-sub"><a href="#32-mixed-ordering">3.2 Mixed Ordering</a></li>
  <li class="toc-sub"><a href="#33-reverse">3.3 Reverse</a></li>
  <li><a href="#4-distinct-operations">4. Distinct Operations</a></li>
  <li><a href="#5-pagination">5. Pagination</a></li>
  <li class="toc-sub"><a href="#51-offset%2Flimit-pattern">5.1 Offset/Limit Pattern</a></li>
  <li class="toc-sub"><a href="#52-pagination-with-filtering">5.2 Pagination with Filtering</a></li>
  <li><a href="#6-joins">6. Joins</a></li>
  <li class="toc-sub"><a href="#61-simple-inner-join">6.1 Simple Inner Join</a></li>
  <li class="toc-sub"><a href="#62-join-with-additional-filter">6.2 Join with Additional Filter</a></li>
  <li class="toc-sub"><a href="#63-join-with-grouped-results">6.3 Join with Grouped Results</a></li>
  <li class="toc-sub"><a href="#64-left-outer-join">6.4 Left Outer Join</a></li>
  <li class="toc-sub"><a href="#65-cross-join">6.5 Cross Join</a></li>
  <li><a href="#7-grouping-and-aggregation">7. Grouping and Aggregation</a></li>
  <li class="toc-sub"><a href="#71-basic-grouping">7.1 Basic Grouping</a></li>
  <li class="toc-sub"><a href="#72-group-with-multiple-aggregates">7.2 Group with Multiple Aggregates</a></li>
  <li class="toc-sub"><a href="#73-group-with-post-filter">7.3 Group with Post-Filter</a></li>
  <li><a href="#8-window-functions">8. Window Functions</a></li>
  <li class="toc-sub"><a href="#81-row_number">8.1 ROW_NUMBER</a></li>
  <li class="toc-sub"><a href="#82-rank">8.2 RANK</a></li>
  <li class="toc-sub"><a href="#83-dense_rank">8.3 DENSE_RANK</a></li>
  <li class="toc-sub"><a href="#84-multiple-window-functions">8.4 Multiple Window Functions</a></li>
  <li class="toc-sub"><a href="#85-filtering-on-window-function-results">8.5 Filtering on Window Function Results</a></li>
  <li><a href="#9-scalar-aggregates-on-root-queries">9. Scalar Aggregates on Root Queries</a></li>
  <li><a href="#10-quantifiers">10. Quantifiers</a></li>
  <li class="toc-sub"><a href="#101-any-operation">10.1 Any Operation</a></li>
  <li class="toc-sub"><a href="#102-all-operation">10.2 All Operation</a></li>
  <li class="toc-sub"><a href="#103-contains-operation">10.3 Contains Operation</a></li>
  <li><a href="#11-element-retrieval">11. Element Retrieval</a></li>
  <li><a href="#12-materialisation">12. Materialisation</a></li>
  <li><a href="#13-parameters-and-auto-parameterisation">13. Parameters and Auto-Parameterisation</a></li>
  <li class="toc-sub"><a href="#131-external-parameter-objects">13.1 External Parameter Objects</a></li>
  <li class="toc-sub"><a href="#132-literal-auto-parameterisation">13.2 Literal Auto-Parameterisation</a></li>
  <li class="toc-sub"><a href="#133-array-membership">13.3 Array Membership</a></li>
  <li class="toc-sub"><a href="#134-case-insensitive-helper-functions">13.4 Case-Insensitive Helper Functions</a></li>
  <li><a href="#14-crud-operations">14. CRUD Operations</a></li>
  <li class="toc-sub"><a href="#141-insert-statements">14.1 INSERT Statements</a></li>
  <li class="toc-sub"><a href="#142-update-statements">14.2 UPDATE Statements</a></li>
  <li class="toc-sub"><a href="#143-delete-statements">14.3 DELETE Statements</a></li>
  <li class="toc-sub"><a href="#144-safety-features">14.4 Safety Features</a></li>
  <li class="toc-sub"><a href="#145-executing-crud-operations">14.5 Executing CRUD Operations</a></li>
  <li><a href="#15-query-composition-and-reusability">15. Query Composition and Reusability</a></li>
  <li class="toc-sub"><a href="#151-chaining-operations-on-plans">15.1 Chaining Operations on Plans</a></li>
  <li class="toc-sub"><a href="#152-immutability-and-base-queries">15.2 Immutability and Base Queries</a></li>
  <li class="toc-sub"><a href="#153-branching-from-base-queries">15.3 Branching from Base Queries</a></li>
  <li class="toc-sub"><a href="#154-parameter-accumulation">15.4 Parameter Accumulation</a></li>
  <li class="toc-sub"><a href="#155-composition-with-all-operations">15.5 Composition with All Operations</a></li>
  <li class="toc-sub"><a href="#156-practical-patterns">15.6 Practical Patterns</a></li>
  <li><a href="#16-row-filters">16. Row Filters</a></li>
  <li class="toc-sub"><a href="#161-basic-usage">16.1 Basic Usage</a></li>
  <li class="toc-sub"><a href="#162-per-operation-filters">16.2 Per-Operation Filters</a></li>
  <li class="toc-sub"><a href="#163-behavior-notes">16.3 Behavior Notes</a></li>
</ul>
</nav>
    </div>

    <footer class="page-nav">
  <a href="index.html" class="prev">‚Üê Getting Started</a>
  <a href="api-reference.html" class="next">API Reference ‚Üí</a>
</footer>
  </main>

  <!-- Mobile Menu Script -->
  <script>
    (function() {
      const hamburger = document.getElementById('hamburger');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');

      function toggleMenu() {
        hamburger.classList.toggle('active');
        sidebar.classList.toggle('mobile-open');
        overlay.classList.toggle('active');
        document.body.style.overflow = sidebar.classList.contains('mobile-open') ? 'hidden' : '';
      }

      function closeMenu() {
        hamburger.classList.remove('active');
        sidebar.classList.remove('mobile-open');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
      }

      hamburger.addEventListener('click', toggleMenu);
      overlay.addEventListener('click', closeMenu);

      // Close menu when clicking a nav link
      const navLinks = sidebar.querySelectorAll('.nav-list a');
      navLinks.forEach(link => {
        link.addEventListener('click', closeMenu);
      });

      // Close menu on escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && sidebar.classList.contains('mobile-open')) {
          closeMenu();
        }
      });
    })();
  </script>
</body>
</html>
