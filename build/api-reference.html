<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Tinqer - Type-safe LINQ-to-SQL query builder for TypeScript">
  <title>API Reference - Tinqer Documentation</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Mobile Header -->
  <header class="mobile-header">
    <a href="index.html" class="mobile-logo">
      <img src="logo.svg" alt="Tinqer" class="logo-icon" />
      <span>Tinqer</span>
    </a>
    <button class="hamburger" id="hamburger" aria-label="Toggle menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </header>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="overlay"></div>

  <!-- Sidebar Navigation -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <a href="index.html" class="logo">
        <img src="logo.svg" alt="Tinqer" class="logo-icon" />
        <span>Tinqer</span>
      </a>
      <p class="tagline">Type-safe LINQ-to-SQL for TypeScript</p>
      <a href="https://github.com/tinqerjs/tinqer" class="github-link" target="_blank" rel="noopener noreferrer">
        <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
        </svg>
        <span>GitHub</span>
      </a>
    </div>
    <ul class="nav-list">
  <li><a href="index.html">Getting Started</a></li>
  <li><a href="guide.html">Guide</a></li>
  <li class="active"><a href="api-reference.html">API Reference</a></li>
  <li><a href="adapters.html">Adapters</a></li>
  <li><a href="development.html">Development</a></li>
  <li><a href="architecture.html">Architecture</a></li>
</ul>
  </nav>

  <!-- Main Content -->
  <main class="content">
    <div class="breadcrumb"><a href="index.html">Home</a> / <span>API Reference</span></div>

    <div class="content-wrapper">
      <article class="markdown-body">
        <p><a href="../README.md">← Back to README</a></p>
<h1 id="tinqer-api-reference" tabindex="-1"><a class="anchor" href="#tinqer-api-reference" aria-hidden="true">#</a> Tinqer API Reference</h1>
<p>Reference for adapter execution helpers, typed contexts, and query utilities.</p>
<h2 id="table-of-contents" tabindex="-1"><a class="anchor" href="#table-of-contents" aria-hidden="true">#</a> Table of Contents</h2>
<ul>
<li><a href="#1-execution-apis">1. Execution APIs</a>
<ul>
<li><a href="#11-defineselect-tosql--executeselect">1.1 defineSelect, toSql &amp; executeSelect</a></li>
<li><a href="#12-defineinsert-tosql--executeinsert">1.2 defineInsert, toSql &amp; executeInsert</a></li>
<li><a href="#13-defineupdate-tosql--executeupdate">1.3 defineUpdate, toSql &amp; executeUpdate</a></li>
<li><a href="#14-definedelete-tosql--executedelete">1.4 defineDelete, toSql &amp; executeDelete</a></li>
<li><a href="#15-executeoptions--sqlresult">1.5 ExecuteOptions &amp; SqlResult</a></li>
</ul>
</li>
<li><a href="#2-type-safe-contexts">2. Type-Safe Contexts</a>
<ul>
<li><a href="#21-createschema">2.1 createSchema</a></li>
<li><a href="#22-withrowfilters">2.2 withRowFilters</a></li>
<li><a href="#23-withcontext">2.3 withContext</a></li>
</ul>
</li>
<li><a href="#3-helper-utilities">3. Helper Utilities</a>
<ul>
<li><a href="#31-createqueryhelpers">3.1 createQueryHelpers</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="1-execution-apis" tabindex="-1"><a class="anchor" href="#1-execution-apis" aria-hidden="true">#</a> 1. Execution APIs</h2>
<p>Tinqer uses a two-step API:</p>
<ol>
<li><strong>Plan definition</strong> (<code>define*</code> functions from <code>@tinqerjs/tinqer</code>) - Creates type-safe query plans</li>
<li><strong>Execution or SQL generation</strong> (<code>execute*</code> or <code>toSql</code> from adapter packages) - Executes plans or generates SQL</li>
</ol>
<p>Adapter packages live in <code>@tinqerjs/pg-promise-adapter</code> (PostgreSQL) and <code>@tinqerjs/better-sqlite3-adapter</code> (SQLite).</p>
<h3 id="11-defineselect%2C-tosql-%26-executeselect" tabindex="-1"><a class="anchor" href="#11-defineselect%2C-tosql-%26-executeselect" aria-hidden="true">#</a> 1.1 defineSelect, toSql &amp; executeSelect</h3>
<p>Creates SELECT query plans, generates SQL, or executes queries.</p>
<p><strong>Signatures</strong></p>
<pre class="hljs"><code><span class="hljs-comment">// Plan definition (from @tinqerjs/tinqer)</span>
<span class="hljs-keyword">function</span> defineSelect&lt;<span class="hljs-title class_">TSchema</span>, <span class="hljs-title class_">TParams</span>, <span class="hljs-title class_">TResult</span>&gt;(
  <span class="hljs-attr">schema</span>: <span class="hljs-title class_">DatabaseSchema</span>&lt;<span class="hljs-title class_">TSchema</span>&gt;,
  <span class="hljs-attr">queryBuilder</span>: <span class="hljs-function">(<span class="hljs-params">
    <span class="hljs-attr">q</span>: <span class="hljs-title class_">QueryBuilder</span>&lt;<span class="hljs-title class_">TSchema</span>&gt;,
    <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>,
    <span class="hljs-attr">helpers</span>: <span class="hljs-title class_">QueryHelpers</span>,
  </span>) =&gt;</span> <span class="hljs-title class_">Queryable</span>&lt;<span class="hljs-title class_">TResult</span>&gt; | <span class="hljs-title class_">OrderedQueryable</span>&lt;<span class="hljs-title class_">TResult</span>&gt; | <span class="hljs-title class_">TerminalQuery</span>&lt;<span class="hljs-title class_">TResult</span>&gt;,
  <span class="hljs-attr">paramDefaults</span>?: <span class="hljs-title class_">TParams</span>,
): <span class="hljs-title class_">SelectPlanHandle</span>&lt;<span class="hljs-title class_">TResult</span>, <span class="hljs-title class_">TParams</span>&gt; | <span class="hljs-title class_">SelectTerminalHandle</span>&lt;<span class="hljs-title class_">TResult</span>, <span class="hljs-title class_">TParams</span>&gt;;

<span class="hljs-comment">// SQL generation (from adapter packages)</span>
<span class="hljs-keyword">function</span> toSql&lt;<span class="hljs-title class_">TParams</span>&gt;(
  <span class="hljs-attr">plan</span>: <span class="hljs-title class_">SelectPlanHandle</span>&lt;<span class="hljs-built_in">unknown</span>, <span class="hljs-title class_">TParams</span>&gt; | <span class="hljs-title class_">SelectTerminalHandle</span>&lt;<span class="hljs-built_in">unknown</span>, <span class="hljs-title class_">TParams</span>&gt;,
  <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>,
): { <span class="hljs-attr">sql</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span> &amp; <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt; };

<span class="hljs-comment">// Execution (from adapter packages)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> executeSelect&lt;<span class="hljs-title class_">TResult</span>, <span class="hljs-title class_">TParams</span>&gt;(
  <span class="hljs-attr">db</span>: <span class="hljs-title class_">PgDatabase</span> | <span class="hljs-title class_">BetterSqlite3Database</span>,
  <span class="hljs-attr">plan</span>: <span class="hljs-title class_">SelectPlanHandle</span>&lt;<span class="hljs-title class_">TResult</span>, <span class="hljs-title class_">TParams</span>&gt; | <span class="hljs-title class_">SelectTerminalHandle</span>&lt;<span class="hljs-title class_">TResult</span>, <span class="hljs-title class_">TParams</span>&gt;,
  <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>,
  <span class="hljs-attr">options</span>?: <span class="hljs-title class_">ExecuteOptions</span>,
): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">TResult</span>[] | <span class="hljs-title class_">TResult</span>&gt;;
</code></pre>
<p><strong>Example - SQL Generation</strong></p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema, defineSelect } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { toSql } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> { sql, params } = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { minAge: <span class="hljs-built_in">number</span> }</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt;= params.<span class="hljs-property">minAge</span>)
      .<span class="hljs-title function_">select</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> ({ <span class="hljs-attr">id</span>: u.<span class="hljs-property">id</span>, <span class="hljs-attr">name</span>: u.<span class="hljs-property">name</span> })),
  ),
  { <span class="hljs-attr">minAge</span>: <span class="hljs-number">18</span> },
);
<span class="hljs-comment">// sql: SELECT &quot;id&quot; AS &quot;id&quot;, &quot;name&quot; AS &quot;name&quot; FROM &quot;users&quot; WHERE &quot;age&quot; &gt;= $(minAge)</span>
<span class="hljs-comment">// params: { minAge: 18 }</span>
</code></pre>
<p><strong>Example - Execution</strong></p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { executeSelect } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeSelect</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { minAge: <span class="hljs-built_in">number</span> }</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">age</span> &gt;= params.<span class="hljs-property">minAge</span>)
      .<span class="hljs-title function_">orderBy</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">name</span>),
  { <span class="hljs-attr">minAge</span>: <span class="hljs-number">21</span> },
);
<span class="hljs-comment">// Returns: Array of user objects</span>
</code></pre>
<h3 id="12-defineinsert%2C-tosql-%26-executeinsert" tabindex="-1"><a class="anchor" href="#12-defineinsert%2C-tosql-%26-executeinsert" aria-hidden="true">#</a> 1.2 defineInsert, toSql &amp; executeInsert</h3>
<p>Creates INSERT query plans, generates SQL, or executes queries with optional RETURNING clauses.</p>
<p><strong>Signatures</strong></p>
<pre class="hljs"><code><span class="hljs-comment">// Plan definition (from @tinqerjs/tinqer)</span>
<span class="hljs-keyword">function</span> defineInsert&lt;<span class="hljs-title class_">TSchema</span>, <span class="hljs-title class_">TParams</span>, <span class="hljs-title class_">TTable</span>, <span class="hljs-title class_">TReturning</span> = <span class="hljs-built_in">never</span>&gt;(
  <span class="hljs-attr">schema</span>: <span class="hljs-title class_">DatabaseSchema</span>&lt;<span class="hljs-title class_">TSchema</span>&gt;,
  <span class="hljs-attr">queryBuilder</span>: <span class="hljs-function">(<span class="hljs-params">
    <span class="hljs-attr">q</span>: <span class="hljs-title class_">QueryBuilder</span>&lt;<span class="hljs-title class_">TSchema</span>&gt;,
    <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>,
    <span class="hljs-attr">helpers</span>: <span class="hljs-title class_">QueryHelpers</span>,
  </span>) =&gt;</span> <span class="hljs-title class_">Insertable</span>&lt;<span class="hljs-title class_">TTable</span>&gt; | <span class="hljs-title class_">InsertableWithReturning</span>&lt;<span class="hljs-title class_">TTable</span>, <span class="hljs-title class_">TReturning</span>&gt;,
  <span class="hljs-attr">paramDefaults</span>?: <span class="hljs-title class_">TParams</span>,
): <span class="hljs-title class_">InsertPlanHandle</span>&lt;<span class="hljs-title class_">TTable</span>, <span class="hljs-title class_">TReturning</span>, <span class="hljs-title class_">TParams</span>&gt;;

<span class="hljs-comment">// SQL generation (from adapter packages)</span>
<span class="hljs-keyword">function</span> toSql&lt;<span class="hljs-title class_">TParams</span>&gt;(
  <span class="hljs-attr">plan</span>: <span class="hljs-title class_">InsertPlanHandle</span>&lt;<span class="hljs-built_in">unknown</span>, <span class="hljs-built_in">unknown</span>, <span class="hljs-title class_">TParams</span>&gt;,
  <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>,
): { <span class="hljs-attr">sql</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span> &amp; <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt; };

<span class="hljs-comment">// Execution (from adapter packages)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> executeInsert&lt;<span class="hljs-title class_">TTable</span>, <span class="hljs-title class_">TReturning</span>, <span class="hljs-title class_">TParams</span>&gt;(
  <span class="hljs-attr">db</span>: <span class="hljs-title class_">PgDatabase</span> | <span class="hljs-title class_">BetterSqlite3Database</span>,
  <span class="hljs-attr">plan</span>: <span class="hljs-title class_">InsertPlanHandle</span>&lt;<span class="hljs-title class_">TTable</span>, <span class="hljs-title class_">TReturning</span>, <span class="hljs-title class_">TParams</span>&gt;,
  <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>,
  <span class="hljs-attr">options</span>?: <span class="hljs-title class_">ExecuteOptions</span>,
): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">TReturning</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">never</span> ? <span class="hljs-built_in">number</span> : <span class="hljs-title class_">TReturning</span>[]&gt;;
</code></pre>
<p><strong>Example - SQL Generation</strong></p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema, defineInsert } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { toSql } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> { sql, params } = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineInsert</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { name: <span class="hljs-built_in">string</span> }</span>) =&gt;</span>
    q.<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">values</span>({ <span class="hljs-attr">name</span>: params.<span class="hljs-property">name</span> }),
  ),
  { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> },
);
<span class="hljs-comment">// sql: INSERT INTO &quot;users&quot; (&quot;name&quot;) VALUES ($(name))</span>
<span class="hljs-comment">// params: { name: &quot;Alice&quot; }</span>
</code></pre>
<p><strong>Example - Execution</strong></p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { executeInsert } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-comment">// Without RETURNING - returns number of rows inserted</span>
<span class="hljs-keyword">const</span> rowCount = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeInsert</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { name: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> q.<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">values</span>({ <span class="hljs-attr">name</span>: params.<span class="hljs-property">name</span> }),
  { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> },
);

<span class="hljs-comment">// With RETURNING - returns inserted rows</span>
<span class="hljs-keyword">const</span> createdUsers = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeInsert</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { name: <span class="hljs-built_in">string</span> }</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">values</span>({ <span class="hljs-attr">name</span>: params.<span class="hljs-property">name</span> })
      .<span class="hljs-title function_">returning</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> ({ <span class="hljs-attr">id</span>: u.<span class="hljs-property">id</span>, <span class="hljs-attr">name</span>: u.<span class="hljs-property">name</span> })),
  { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Bob&quot;</span> },
);
</code></pre>
<p><strong>Example - Upsert (ON CONFLICT)</strong></p>
<pre class="hljs"><code><span class="hljs-comment">// PostgreSQL + SQLite: INSERT ... ON CONFLICT</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">executeInsert</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { email: <span class="hljs-built_in">string</span>; name: <span class="hljs-built_in">string</span> }</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">insertInto</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">values</span>({ <span class="hljs-attr">email</span>: params.<span class="hljs-property">email</span>, <span class="hljs-attr">name</span>: params.<span class="hljs-property">name</span> })
      .<span class="hljs-title function_">onConflict</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">email</span>)
      .<span class="hljs-title function_">doUpdateSet</span>(<span class="hljs-function">(<span class="hljs-params">_existing, excluded</span>) =&gt;</span> ({ <span class="hljs-attr">name</span>: excluded.<span class="hljs-property">name</span> })),
  { <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;alice@example.com&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> },
);

<span class="hljs-comment">// Composite conflict targets are supported:</span>
<span class="hljs-comment">// .onConflict((u) =&gt; u.email, (u) =&gt; u.name)</span>
</code></pre>
<h3 id="13-defineupdate%2C-tosql-%26-executeupdate" tabindex="-1"><a class="anchor" href="#13-defineupdate%2C-tosql-%26-executeupdate" aria-hidden="true">#</a> 1.3 defineUpdate, toSql &amp; executeUpdate</h3>
<p>Creates UPDATE query plans, generates SQL, or executes queries with optional RETURNING clauses.</p>
<p><strong>Signatures</strong></p>
<pre class="hljs"><code><span class="hljs-comment">// Plan definition (from @tinqerjs/tinqer)</span>
<span class="hljs-keyword">function</span> defineUpdate&lt;<span class="hljs-title class_">TSchema</span>, <span class="hljs-title class_">TParams</span>, <span class="hljs-title class_">TTable</span>, <span class="hljs-title class_">TReturning</span> = <span class="hljs-built_in">never</span>&gt;(
  <span class="hljs-attr">schema</span>: <span class="hljs-title class_">DatabaseSchema</span>&lt;<span class="hljs-title class_">TSchema</span>&gt;,
  <span class="hljs-attr">queryBuilder</span>: <span class="hljs-function">(<span class="hljs-params">
    <span class="hljs-attr">q</span>: <span class="hljs-title class_">QueryBuilder</span>&lt;<span class="hljs-title class_">TSchema</span>&gt;,
    <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>,
    <span class="hljs-attr">helpers</span>: <span class="hljs-title class_">QueryHelpers</span>,
  </span>) =&gt;</span>
    | <span class="hljs-title class_">UpdatableWithSet</span>&lt;<span class="hljs-title class_">TTable</span>&gt;
    | <span class="hljs-title class_">UpdatableComplete</span>&lt;<span class="hljs-title class_">TTable</span>&gt;
    | <span class="hljs-title class_">UpdatableWithReturning</span>&lt;<span class="hljs-title class_">TTable</span>, <span class="hljs-title class_">TReturning</span>&gt;,
  <span class="hljs-attr">paramDefaults</span>?: <span class="hljs-title class_">TParams</span>,
): <span class="hljs-title class_">UpdatePlanHandle</span>&lt;<span class="hljs-title class_">TTable</span>, <span class="hljs-title class_">TReturning</span>, <span class="hljs-title class_">TParams</span>&gt;;

<span class="hljs-comment">// SQL generation (from adapter packages)</span>
<span class="hljs-keyword">function</span> toSql&lt;<span class="hljs-title class_">TParams</span>&gt;(
  <span class="hljs-attr">plan</span>: <span class="hljs-title class_">UpdatePlanHandle</span>&lt;<span class="hljs-built_in">unknown</span>, <span class="hljs-built_in">unknown</span>, <span class="hljs-title class_">TParams</span>&gt;,
  <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>,
): { <span class="hljs-attr">sql</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span> &amp; <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt; };

<span class="hljs-comment">// Execution (from adapter packages)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> executeUpdate&lt;<span class="hljs-title class_">TTable</span>, <span class="hljs-title class_">TReturning</span>, <span class="hljs-title class_">TParams</span>&gt;(
  <span class="hljs-attr">db</span>: <span class="hljs-title class_">PgDatabase</span> | <span class="hljs-title class_">BetterSqlite3Database</span>,
  <span class="hljs-attr">plan</span>: <span class="hljs-title class_">UpdatePlanHandle</span>&lt;<span class="hljs-title class_">TTable</span>, <span class="hljs-title class_">TReturning</span>, <span class="hljs-title class_">TParams</span>&gt;,
  <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>,
  <span class="hljs-attr">options</span>?: <span class="hljs-title class_">ExecuteOptions</span>,
): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">TReturning</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">never</span> ? <span class="hljs-built_in">number</span> : <span class="hljs-title class_">TReturning</span>[]&gt;;
</code></pre>
<p><strong>Example - SQL Generation</strong></p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema, defineUpdate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { toSql } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">lastLogin</span>: <span class="hljs-title class_">Date</span> };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> { sql, params } = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineUpdate</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { cutoff: <span class="hljs-built_in">Date</span> }</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">set</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;inactive&quot;</span> })
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">lastLogin</span> &lt; params.<span class="hljs-property">cutoff</span>),
  ),
  { <span class="hljs-attr">cutoff</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&quot;2024-01-01&quot;</span>) },
);
<span class="hljs-comment">// sql: UPDATE &quot;users&quot; SET &quot;status&quot; = &#x27;inactive&#x27; WHERE &quot;lastLogin&quot; &lt; $(cutoff)</span>
<span class="hljs-comment">// params: { cutoff: Date }</span>
</code></pre>
<p><strong>Example - Execution</strong></p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { executeUpdate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">lastLogin</span>: <span class="hljs-title class_">Date</span>; <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span> };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-comment">// Without RETURNING - returns number of rows updated</span>
<span class="hljs-keyword">const</span> updatedRows = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeUpdate</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { cutoff: <span class="hljs-built_in">Date</span> }</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">set</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;inactive&quot;</span> })
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">lastLogin</span> &lt; params.<span class="hljs-property">cutoff</span>),
  { <span class="hljs-attr">cutoff</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&quot;2024-01-01&quot;</span>) },
);

<span class="hljs-comment">// With RETURNING - returns updated rows</span>
<span class="hljs-keyword">const</span> updatedUsers = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeUpdate</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { cutoff: <span class="hljs-built_in">Date</span> }</span>) =&gt;</span>
    q
      .<span class="hljs-title function_">update</span>(<span class="hljs-string">&quot;users&quot;</span>)
      .<span class="hljs-title function_">set</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;inactive&quot;</span> })
      .<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">lastLogin</span> &lt; params.<span class="hljs-property">cutoff</span>)
      .<span class="hljs-title function_">returning</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> ({ <span class="hljs-attr">id</span>: u.<span class="hljs-property">id</span>, <span class="hljs-attr">status</span>: u.<span class="hljs-property">status</span> })),
  { <span class="hljs-attr">cutoff</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&quot;2024-01-01&quot;</span>) },
);
</code></pre>
<h3 id="14-definedelete%2C-tosql-%26-executedelete" tabindex="-1"><a class="anchor" href="#14-definedelete%2C-tosql-%26-executedelete" aria-hidden="true">#</a> 1.4 defineDelete, toSql &amp; executeDelete</h3>
<p>Creates DELETE query plans, generates SQL, or executes queries.</p>
<p><strong>Signatures</strong></p>
<pre class="hljs"><code><span class="hljs-comment">// Plan definition (from @tinqerjs/tinqer)</span>
<span class="hljs-keyword">function</span> defineDelete&lt;<span class="hljs-title class_">TSchema</span>, <span class="hljs-title class_">TParams</span>&gt;(
  <span class="hljs-attr">schema</span>: <span class="hljs-title class_">DatabaseSchema</span>&lt;<span class="hljs-title class_">TSchema</span>&gt;,
  <span class="hljs-attr">queryBuilder</span>: <span class="hljs-function">(<span class="hljs-params">
    <span class="hljs-attr">q</span>: <span class="hljs-title class_">QueryBuilder</span>&lt;<span class="hljs-title class_">TSchema</span>&gt;,
    <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>,
    <span class="hljs-attr">helpers</span>: <span class="hljs-title class_">QueryHelpers</span>,
  </span>) =&gt;</span> <span class="hljs-title class_">Deletable</span>&lt;<span class="hljs-built_in">unknown</span>&gt; | <span class="hljs-title class_">DeletableComplete</span>&lt;<span class="hljs-built_in">unknown</span>&gt;,
  <span class="hljs-attr">paramDefaults</span>?: <span class="hljs-title class_">TParams</span>,
): <span class="hljs-title class_">DeletePlanHandle</span>&lt;<span class="hljs-title class_">TParams</span>&gt;;

<span class="hljs-comment">// SQL generation (from adapter packages)</span>
<span class="hljs-keyword">function</span> toSql&lt;<span class="hljs-title class_">TParams</span>&gt;(
  <span class="hljs-attr">plan</span>: <span class="hljs-title class_">DeletePlanHandle</span>&lt;<span class="hljs-title class_">TParams</span>&gt;,
  <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>,
): { <span class="hljs-attr">sql</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span> &amp; <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt; };

<span class="hljs-comment">// Execution (from adapter packages)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> executeDelete&lt;<span class="hljs-title class_">TParams</span>&gt;(
  <span class="hljs-attr">db</span>: <span class="hljs-title class_">PgDatabase</span> | <span class="hljs-title class_">BetterSqlite3Database</span>,
  <span class="hljs-attr">plan</span>: <span class="hljs-title class_">DeletePlanHandle</span>&lt;<span class="hljs-title class_">TParams</span>&gt;,
  <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>,
  <span class="hljs-attr">options</span>?: <span class="hljs-title class_">ExecuteOptions</span>,
): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">number</span>&gt;;
</code></pre>
<p><strong>Example - SQL Generation</strong></p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema, defineDelete } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { toSql } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span> };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> { sql, params } = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineDelete</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { status: <span class="hljs-built_in">string</span> }</span>) =&gt;</span>
    q.<span class="hljs-title function_">deleteFrom</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">status</span> === params.<span class="hljs-property">status</span>),
  ),
  { <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;inactive&quot;</span> },
);
<span class="hljs-comment">// sql: DELETE FROM &quot;users&quot; WHERE &quot;status&quot; = $(status)</span>
<span class="hljs-comment">// params: { status: &quot;inactive&quot; }</span>
</code></pre>
<p><strong>Example - Execution</strong></p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { executeDelete } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span> };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> deletedCount = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeDelete</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q, <span class="hljs-attr">params</span>: { status: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> q.<span class="hljs-title function_">deleteFrom</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">status</span> === params.<span class="hljs-property">status</span>),
  { <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;inactive&quot;</span> },
);
</code></pre>
<h3 id="15-executeoptions-%26-sqlresult" tabindex="-1"><a class="anchor" href="#15-executeoptions-%26-sqlresult" aria-hidden="true">#</a> 1.5 ExecuteOptions &amp; SqlResult</h3>
<p>Both adapters expose <code>ExecuteOptions</code> and <code>SqlResult</code> for inspection and typing.</p>
<pre class="hljs"><code><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ExecuteOptions</span> {
  <span class="hljs-attr">onSql</span>?: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">result</span>: <span class="hljs-title class_">SqlResult</span>&lt;<span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;, <span class="hljs-built_in">unknown</span>&gt;</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">SqlResult</span>&lt;<span class="hljs-title class_">TParams</span>, <span class="hljs-title class_">TResult</span>&gt; {
  <span class="hljs-attr">sql</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">params</span>: <span class="hljs-title class_">TParams</span>;
  <span class="hljs-attr">_resultType</span>?: <span class="hljs-title class_">TResult</span>; <span class="hljs-comment">// phantom type information</span>
}
</code></pre>
<p>Use <code>onSql</code> for logging, testing, or debugging without changing execution flow.</p>
<hr>
<h2 id="2-type-safe-contexts" tabindex="-1"><a class="anchor" href="#2-type-safe-contexts" aria-hidden="true">#</a> 2. Type-Safe Contexts</h2>
<h3 id="21-createschema" tabindex="-1"><a class="anchor" href="#21-createschema" aria-hidden="true">#</a> 2.1 createSchema</h3>
<p>Creates a phantom-typed <code>DatabaseSchema</code> that ties table names to row types. The schema is passed to execution functions, which provide a type-safe query builder through the lambda’s first parameter.</p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { executeSelect } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span> };
  <span class="hljs-attr">posts</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">userId</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-comment">// Schema is passed to executeSelect, which provides the query builder &#x27;q&#x27; parameter</span>
<span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeSelect</span>(
  db,
  schema,
  <span class="hljs-function">(<span class="hljs-params">q</span>) =&gt;</span> q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.<span class="hljs-property">email</span>.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&quot;@example.com&quot;</span>)),
  {},
);
</code></pre>
<h3 id="22-withrowfilters" tabindex="-1"><a class="anchor" href="#22-withrowfilters" aria-hidden="true">#</a> 2.2 withRowFilters</h3>
<p>Attaches row-level predicates to a schema so that SELECT/UPDATE/DELETE operations automatically include them (RLS-like behavior for query generation).</p>
<p>Filters are provided per table, and <strong>all tables must be covered</strong>. For tables that should not be scoped by row filters, use <code>null</code>.</p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">orgId</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span> };
  <span class="hljs-attr">posts</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">orgId</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> };
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">ScopeContext</span> = { <span class="hljs-attr">orgId</span>: <span class="hljs-built_in">number</span> };

<span class="hljs-keyword">const</span> baseSchema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> rowFilteredSchema = baseSchema.<span class="hljs-property">withRowFilters</span>&lt;<span class="hljs-title class_">ScopeContext</span>&gt;({
  <span class="hljs-attr">users</span>: <span class="hljs-function">(<span class="hljs-params">u, ctx</span>) =&gt;</span> u.<span class="hljs-property">orgId</span> === ctx.<span class="hljs-property">orgId</span>,
  <span class="hljs-attr">posts</span>: <span class="hljs-function">(<span class="hljs-params">p, ctx</span>) =&gt;</span> p.<span class="hljs-property">orgId</span> === ctx.<span class="hljs-property">orgId</span>,
});
</code></pre>
<p>Notes:</p>
<ul>
<li>Row filters are enforced for SELECT/UPDATE/DELETE only (not required for INSERT).</li>
<li>If a row-filtered schema is used without context binding, it throws (fail closed).</li>
<li>Unrestricted access is done by using the original/base schema directly.</li>
</ul>
<h3 id="23-withcontext" tabindex="-1"><a class="anchor" href="#23-withcontext" aria-hidden="true">#</a> 2.3 withContext</h3>
<p>Binds a concrete context object to a row-filtered schema (typically per request).</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> schema = rowFilteredSchema.<span class="hljs-title function_">withContext</span>({ <span class="hljs-attr">orgId</span>: <span class="hljs-number">7</span> });
</code></pre>
<p>Once bound, you can pass the schema to <code>defineSelect</code> / <code>executeSelect</code> / <code>toSql</code> (and the UPDATE/DELETE equivalents) and the policy is applied automatically.</p>
<hr>
<h2 id="3-helper-utilities" tabindex="-1"><a class="anchor" href="#3-helper-utilities" aria-hidden="true">#</a> 3. Helper Utilities</h2>
<h3 id="31-createqueryhelpers" tabindex="-1"><a class="anchor" href="#31-createqueryhelpers" aria-hidden="true">#</a> 3.1 createQueryHelpers</h3>
<p>Provides helper functions for case-insensitive comparisons and string searches. Helpers are automatically passed as the third parameter to query builder functions.</p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> { createSchema, defineSelect } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/tinqer&quot;</span>;
<span class="hljs-keyword">import</span> { toSql } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tinqerjs/pg-promise-adapter&quot;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Schema</span> {
  <span class="hljs-attr">users</span>: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> };
}

<span class="hljs-keyword">const</span> schema = createSchema&lt;<span class="hljs-title class_">Schema</span>&gt;();

<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">toSql</span>(
  <span class="hljs-title function_">defineSelect</span>(schema, <span class="hljs-function">(<span class="hljs-params">q, params, helpers</span>) =&gt;</span>
    q.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">where</span>(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> helpers.<span class="hljs-property">functions</span>.<span class="hljs-title function_">icontains</span>(u.<span class="hljs-property">name</span>, <span class="hljs-string">&quot;alice&quot;</span>)),
  ),
  {},
);
</code></pre>
<p><strong>Available Helper Functions</strong></p>
<p>Helpers expose the following functions that adapt per database dialect:</p>
<ul>
<li><code>ilike(field, pattern)</code> - Case-insensitive LIKE comparison</li>
<li><code>contains(field, substring)</code> - Check if field contains substring (case-sensitive)</li>
<li><code>icontains(field, substring)</code> - Check if field contains substring (case-insensitive)</li>
<li><code>startsWith(field, prefix)</code> - Check if field starts with prefix (case-sensitive)</li>
<li><code>istartsWith(field, prefix)</code> - Check if field starts with prefix (case-insensitive)</li>
<li><code>endsWith(field, suffix)</code> - Check if field ends with suffix (case-sensitive)</li>
<li><code>iendsWith(field, suffix)</code> - Check if field ends with suffix (case-insensitive)</li>
</ul>
<p><strong>Creating Custom Helpers</strong></p>
<p>You can create helpers with custom functions:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> helpers = createQueryHelpers&lt;<span class="hljs-title class_">Schema</span>&gt;();
<span class="hljs-comment">// Use helpers in your queries through the third parameter</span>
</code></pre>

      </article>

      <nav class="toc">
<h2>On This Page</h2>
<ul>
  <li><a href="#table-of-contents">Table of Contents</a></li>
  <li><a href="#1-execution-apis">1. Execution APIs</a></li>
  <li class="toc-sub"><a href="#11-defineselect%2C-tosql-%26-executeselect">1.1 defineSelect, toSql & executeSelect</a></li>
  <li class="toc-sub"><a href="#12-defineinsert%2C-tosql-%26-executeinsert">1.2 defineInsert, toSql & executeInsert</a></li>
  <li class="toc-sub"><a href="#13-defineupdate%2C-tosql-%26-executeupdate">1.3 defineUpdate, toSql & executeUpdate</a></li>
  <li class="toc-sub"><a href="#14-definedelete%2C-tosql-%26-executedelete">1.4 defineDelete, toSql & executeDelete</a></li>
  <li class="toc-sub"><a href="#15-executeoptions-%26-sqlresult">1.5 ExecuteOptions & SqlResult</a></li>
  <li><a href="#2-type-safe-contexts">2. Type-Safe Contexts</a></li>
  <li class="toc-sub"><a href="#21-createschema">2.1 createSchema</a></li>
  <li class="toc-sub"><a href="#22-withrowfilters">2.2 withRowFilters</a></li>
  <li class="toc-sub"><a href="#23-withcontext">2.3 withContext</a></li>
  <li><a href="#3-helper-utilities">3. Helper Utilities</a></li>
  <li class="toc-sub"><a href="#31-createqueryhelpers">3.1 createQueryHelpers</a></li>
</ul>
</nav>
    </div>

    <footer class="page-nav">
  <a href="guide.html" class="prev">← Guide</a>
  <a href="adapters.html" class="next">Adapters →</a>
</footer>
  </main>

  <!-- Mobile Menu Script -->
  <script>
    (function() {
      const hamburger = document.getElementById('hamburger');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');

      function toggleMenu() {
        hamburger.classList.toggle('active');
        sidebar.classList.toggle('mobile-open');
        overlay.classList.toggle('active');
        document.body.style.overflow = sidebar.classList.contains('mobile-open') ? 'hidden' : '';
      }

      function closeMenu() {
        hamburger.classList.remove('active');
        sidebar.classList.remove('mobile-open');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
      }

      hamburger.addEventListener('click', toggleMenu);
      overlay.addEventListener('click', closeMenu);

      // Close menu when clicking a nav link
      const navLinks = sidebar.querySelectorAll('.nav-list a');
      navLinks.forEach(link => {
        link.addEventListener('click', closeMenu);
      });

      // Close menu on escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && sidebar.classList.contains('mobile-open')) {
          closeMenu();
        }
      });
    })();
  </script>
</body>
</html>
